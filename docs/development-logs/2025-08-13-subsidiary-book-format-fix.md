# 補助簿記入問題フォーマット統一修正

**日時**: 2025年8月13日  
**対象**: Q_L_011-020 (補助簿記入問題)  
**修正理由**: 回答フォームと正答データの形式不一致

## 問題の詳細

### 修正前の状況

- **answer_template_json** (回答フォーム): `receipt`(収入) / `payment`(支出) 形式
- **correct_answer_json** (正答データ): `debit`(借方) / `credit`(貸方) 形式

### フォーマット不一致の問題

補助簿記入問題において、ユーザーが入力する回答フォームと、正答データの列名が異なるため、正しい解答をしても採点で不正解になる可能性があった。

**影響範囲:**

- Q_L_011: 現金出納帳記入問題
- Q_L_012: 当座預金出納帳記入問題
- Q_L_013: 小口現金出納帳記入問題
- Q_L_014: 普通預金通帳記入問題
- Q_L_015: 仕入帳記入問題
- Q_L_016: 売上帳記入問題
- Q_L_017: 商品有高帳（先入先出法）記入問題
- Q_L_018: 商品有高帳（移動平均法）記入問題
- Q_L_019: 売掛金元帳・買掛金元帳記入問題
- Q_L_020: 受取手形記入帳・支払手形記入帳記入問題

## 修正内容

### 実施した修正

`scripts/fix-subsidiary-book-format.js` スクリプトを作成・実行し、全問題のcorrect_answer_jsonを統一：

```javascript
// 修正前
{
  "date": "6/1",
  "description": "前月繰越",
  "debit": 504213,    // 借方
  "credit": 0,        // 貸方
  "balance": 504213
}

// 修正後
{
  "date": "6/1",
  "description": "前月繰越",
  "receipt": 504213,  // 収入
  "payment": 0,       // 支出
  "balance": 504213
}
```

### 修正統計

- **対象問題数**: 10問 (Q_L_011-020)
- **修正エントリ数**: 49個
- **修正対象フィールド**:
  - `debit` → `receipt` (収入)
  - `credit` → `payment` (支出)
  - `balance` → 変更なし（残高）

## 会計実務上の妥当性

**補助簿における標準形式:**

- 現金出納帳、当座預金出納帳等の補助簿では「収入/支出」列が標準
- 「借方/貸方」は総勘定元帳で使用される形式
- 今回の修正により、会計実務に則った正しい形式に統一

## 技術的詳細

**修正スクリプト**: `scripts/fix-subsidiary-book-format.js`

- 正規表現による対象問題の特定
- JSON解析・変換による安全な修正
- 修正統計の出力による確認機能

**検証方法**:

1. 修正前後のデータ形式確認
2. answer_template_jsonとの一致確認
3. 49個全エントリの変換完了確認

## 期待される効果

1. **解答採点の正確性向上**: フォーマット統一により正答判定が正しく動作
2. **ユーザー体験の改善**: 正しい解答が適切に評価される
3. **会計教育の精度向上**: 実務に即した形式での学習が可能

## 追加修正 (2025-08-13)

### 正答表示フォーマット修正

**問題**: ExplanationPanel.tsxでQ_L_011-020の正答が「借方」「貸方」で表示されていた

**修正箇所**:

- `src/components/ExplanationPanel.tsx` (lines 245-246, 250-282, 172-192, 673-686)
  - 帳簿問題のヘッダー: 「借方」「貸方」→「収入」「支出」
  - 正答データ処理: `entry.debit/credit` → `entry.receipt/payment`
  - ユーザー解答比較: `debit_amount/credit_amount` → `receipt_amount/payment_amount`

**結果**: Q_L_011-020の正答表示が適切に「収入」「支出」形式で表示されるようになった

## 今後の注意点

新規の補助簿記入問題作成時は、answer_template_jsonとcorrect_answer_jsonで`receipt`/`payment`形式を統一して使用すること。

---

**修正者**: Claude Code  
**検証状況**: ✅ 完了
