# iOS/Android シミュレーター実行ガイド

> **注意**: 包括的なテスト計画・戦略については [`docs/engineering/test-plan.md`](./engineering/test-plan.md) を参照してください。  
> このドキュメントは実際のシミュレーター実行に特化した実践ガイドです。

## 目的

簿記3級学習アプリ「確実復習」のiOS/Androidシミュレーターでの実際のテスト実行手順を提供し、クロスプラットフォームでの品質検証を効率的に行う。

## テスト方針

このガイドは [包括的テスト計画](./engineering/test-plan.md) のテストピラミッド構成に基づきます:

```
        E2E Tests (5%)
       /              \
      Integration Tests (25%)
     /                      \
    Unit Tests (70%)
```

- **重点領域**: E2Eテスト実行（機能・UIテスト）
- **対象プラットフォーム**: iOS シミュレーター、Android エミュレーター  
- **テストフレームワーク**: Detox (E2E)、Jest (単体・統合)
- **実行環境**: ローカル開発環境

## アプリ概要

- **技術スタック**: React Native + Expo + TypeScript + SQLite
- **主要機能**: 間違えた問題の反復練習による簿記学習支援
- **データ管理**: 完全オフライン、SQLiteローカル保存
- **問題カテゴリ**: 仕訳(250問)、帳簿(40問)、試算表(12問) - 合計302問

## 1. 基本機能テスト（優先度: 高）

### 1.1 アプリ起動・初期化

**シナリオ**: アプリの正常起動とデータベース初期化

**テスト手順**:

1. アプリを初回起動
2. データベースの作成を確認
3. ホーム画面の表示を確認

**期待結果**:

- ホーム画面が正常に表示される
- 3つのメニューボタン（学習開始、復習、学習統計）が表示される
- データベースが正常に初期化される

**iOS/Android差分チェック**:

- 起動時間の差異
- スプラッシュ画面の表示動作
- 初期パーミッションの扱い

### 1.2 ナビゲーションテスト

**シナリオ**: 各画面間の遷移機能

**テスト手順**:

1. ホーム画面 → 学習画面
2. 学習画面 → 問題詳細画面
3. 問題詳細画面 → ホーム画面（戻るボタン）
4. ホーム画面 → 復習画面
5. ホーム画面 → 統計画面

**期待結果**:

- 全ての画面遷移が正常に動作
- タブナビゲーションが正しく機能
- 戻るボタンが期待通りに動作
- 深いナビゲーションスタックが適切に管理される

### 1.3 学習機能テスト

**シナリオ**: カテゴリ別問題解答フロー

**テスト手順**:

1. 学習画面で「仕訳」カテゴリを選択
2. 問題Q_J_001が表示されることを確認（仕訳パターン1の1問目）
3. 解答フィールドに値を入力:
   - 借方科目: 「仕入」
   - 借方金額: 「200000」
   - 貸方科目: 「現金」
   - 貸方金額: 「200000」
4. 解答を送信
5. 結果ダイアログの確認

**期待結果**:

- 問題文が正しく表示される
- 入力フィールドが適切に動作
- 正解判定が正しく行われる
- 解説が表示される
- 次の問題への遷移が可能

**同様テスト**:

- 帳簿カテゴリ（Q_L_001）
- 試算表カテゴリ（Q_T_001）

### 1.4 問題ナビゲーション

**シナリオ**: 問題間の移動機能

**テスト手順**:

1. 問題画面で「前の問題」ボタンをタップ
2. 問題画面で「次の問題」ボタンをタップ
3. 問題番号を直接選択して移動

**期待結果**:

- 解答状態が適切に保持される
- ナビゲーションの制限が正しく適用される
- 問題番号表示が正確

## 2. UI/レイアウトテスト（優先度: 高）

### 2.1 レスポンシブデザイン

**シナリオ**: 異なる画面サイズでの表示確認

**iOS テスト端末** (詳細は [engineering/test-plan.md](./engineering/test-plan.md) 参照):

- iPhone SE (2nd generation) - iOS 14.0+
- iPhone 12 - iOS 15.0+
- iPhone 14 - iOS 16.0+
- iPad (9th generation) - iOS 15.0+

**Android テスト端末**:

- Pixel 4 - Android 11 (小画面)
- Pixel 6 - Android 12 (中画面)
- Galaxy S21 - Android 12 (大画面)
- Galaxy Tab S7 - Android 11 (タブレット)

**期待結果**:

- 全てのUIコンポーネントが画面内に適切に表示される
- テキストが読みやすいサイズで表示される
- ボタンがタッチしやすいサイズに表示される

### 2.2 文字表示・日本語サポート

**シナリオ**: 日本語テキストの表示品質

**テスト項目**:

- 長い問題文の折り返し表示
- ひらがな・カタカナ・漢字の表示品質
- フォントサイズの適切性
- 文字化けの有無

**期待結果**:

- 日本語が正しく表示される
- 文字の視認性が良好
- レイアウトが崩れない

### 2.3 タッチ操作

**シナリオ**: ボタン、入力フィールドのタッチ反応

**テスト手順**:

1. 全てのボタンをタップ
2. 入力フィールドをタップしてフォーカス確認
3. ドロップダウンメニューの操作
4. スクロール操作

**期待結果**:

- 適切な視覚的フィードバック
- タッチ領域が十分な大きさ
- 触覚フィードバック（対応端末）

## 3. データ永続化テスト（優先度: 中）

### 3.1 解答履歴保存

**シナリオ**: 解答データの永続化確認

**テスト手順**:

1. 複数の問題を解答
2. アプリを完全に終了
3. アプリを再起動
4. 統計画面で履歴を確認

**期待結果**:

- 解答履歴が正しく保存される
- 学習進捗が復元される
- データの整合性が保たれる

### 3.2 学習進捗管理

**シナリオ**: 進捗データの継続性

**テスト手順**:

1. 各カテゴリの問題を複数解答
2. 統計画面で進捗を確認
3. アプリ再起動後の進捗確認

**期待結果**:

- 正答率が正確に記録される
- 学習時間が適切に計測される
- カテゴリ別の進捗が正しく表示される

## 4. エラーハンドリングテスト（優先度: 中）

### 4.1 不正入力処理

**シナリオ**: 無効なデータ入力への対応

**テスト手順**:

1. 必須フィールドを空欄で送信
2. 数値フィールドに文字列を入力
3. 負の数値を入力
4. 極端に大きな数値を入力

**期待結果**:

- 適切なエラーメッセージが表示される
- アプリがクラッシュしない
- ユーザーが修正可能な状態を維持

### 4.2 ネットワーク非依存確認

**シナリオ**: オフライン環境での動作確認

**テスト手順**:

1. 機内モードを有効にする
2. 全ての機能を使用
3. データの保存・読み込みを確認

**期待結果**:

- 全機能が正常に動作する
- ネットワークエラーが発生しない
- オフライン専用アプリとして動作

## 5. クロスプラットフォームテスト（優先度: 中）

### 5.1 iOS固有テスト

**テスト項目**:

- SafeArea対応（ノッチ付きデバイス）
- iOS独自UI（ナビゲーション、アラート）
- タッチ感度・応答性
- ダークモード対応

**期待結果**:

- 画面領域が適切に使用される
- iOSのデザインガイドラインに準拠
- スムーズな操作感

### 5.2 Android固有テスト

**テスト項目**:

- ハードウェア戻るボタンの動作
- Material Designコンポーネント
- 権限処理（ストレージアクセス）
- 異なるAndroidバージョンでの動作

**期待結果**:

- Android標準の操作感
- 適切な権限処理
- Material Designガイドラインに準拠

## テスト実行コマンド

### 開発環境セットアップ

```bash
npm install
npx expo doctor  # 環境確認
```

### iOS テスト

```bash
# 開発ビルド実行
npx expo run:ios

# E2Eテスト
npx detox build --configuration ios.sim.debug
npx detox test --configuration ios.sim.debug
```

### Android テスト

```bash
# 開発ビルド実行
npx expo run:android

# E2Eテスト
npx detox build --configuration android.emu.debug
npx detox test --configuration android.emu.debug
```

### 包括的テストスイート

```bash
npm run check:quick      # 型チェック + lint + 単体テスト
npm test -- --coverage   # カバレッジ付きテスト
npm test -- --watch      # ウォッチモード
```

## テスト結果記録

### テスト実行ログ

- 実行日時
- 実行環境（iOS/Androidバージョン）
- テスト結果（成功/失敗）
- 発見された問題
- 修正が必要な項目

### 品質メトリクス

- テストカバレッジ
- 自動テスト実行時間
- 手動テスト実行時間
- 発見された欠陥数

## 継続的改善

### 定期実行

- リリース前の必須テスト実行
- 週次の回帰テスト
- 新機能追加時のテスト追加

### テスト追加方針

- 新機能に対するテストケース作成
- バグ修正に対する回帰テスト追加
- ユーザーフィードバックに基づくテスト強化

---

**作成日**: 2025-08-03  
**最終更新**: 2025-08-03  
**バージョン**: 1.0
