#!/usr/bin/env node

/**
 * é‡è¤‡ã—ã¦ã„ã‚‹è§£èª¬ã‚’å®Œå…¨ã«å€‹åˆ¥åŒ–ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
 * åŒã˜è§£èª¬ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å•é¡Œã‚’ç‰¹å®šã—ã€ãã‚Œãã‚Œå›ºæœ‰ã®è§£èª¬ã«å¤‰æ›´
 */

const fs = require("fs");
const path = require("path");

// TypeScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
const tsFilePath = path.join(
  __dirname,
  "..",
  "src",
  "data",
  "master-questions.ts",
);
const content = fs.readFileSync(tsFilePath, "utf8");

console.log("ğŸ”§ é‡è¤‡è§£èª¬ã‚’å®Œå…¨ã«å€‹åˆ¥åŒ–ä¸­...\n");

// ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
const startPattern = /export const masterQuestions[^=]*=\s*\[/;
const startMatch = content.match(startPattern);
const startIndex = startMatch.index + startMatch[0].length - 1;

let depth = 0;
let endIndex = -1;
let inString = false;
let escapeNext = false;

for (let i = startIndex; i < content.length; i++) {
  const char = content[i];

  if (escapeNext) {
    escapeNext = false;
    continue;
  }

  if (char === "\\") {
    escapeNext = true;
    continue;
  }

  if (char === '"' && !inString) {
    inString = true;
  } else if (char === '"' && inString) {
    inString = false;
  }

  if (!inString) {
    if (char === "[" || char === "{") {
      depth++;
    } else if (char === "]" || char === "}") {
      depth--;
      if (depth === 0 && char === "]") {
        endIndex = i + 1;
        break;
      }
    }
  }
}

const dataString = content.substring(startIndex, endIndex);
const questions = eval(dataString);

// é‡è¤‡è§£èª¬ã‚’ãƒãƒƒãƒ—åŒ–
const explanationMap = new Map();
questions.forEach((question) => {
  const explanation = question.explanation.trim();
  if (!explanationMap.has(explanation)) {
    explanationMap.set(explanation, []);
  }
  explanationMap.get(explanation).push(question);
});

// é‡è¤‡ã—ã¦ã„ã‚‹è§£èª¬ã‚’ç‰¹å®š
const duplicates = Array.from(explanationMap.entries()).filter(
  ([explanation, questionList]) => questionList.length > 1,
);

console.log(
  `ğŸ” ${duplicates.length}ç¨®é¡ã®é‡è¤‡è§£èª¬ã‚’ç™ºè¦‹ã—ã¾ã—ãŸã€‚å€‹åˆ¥åŒ–ã‚’é–‹å§‹ã—ã¾ã™...\n`,
);

// å•é¡Œå›ºæœ‰ã®è©³ç´°è§£èª¬ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
function generateUniqueExplanation(question, duplicateIndex, totalDuplicates) {
  const questionText = question.question_text;
  const questionId = question.id;

  try {
    const correctAnswer = JSON.parse(question.correct_answer_json);

    // é‡‘é¡ã‚’æŠ½å‡º
    const amounts = [];
    const amountMatches = questionText.match(/[\d,]+å††/g);
    if (amountMatches) {
      amounts.push(...amountMatches);
    }

    // ç¬¬1å•ï¼ˆä»•è¨³å•é¡Œï¼‰ã®å€‹åˆ¥åŒ–
    if (questionId.startsWith("Q_J_")) {
      // å…·ä½“çš„ãªå•é¡ŒIDã«åŸºã¥ãå€‹åˆ¥è§£èª¬
      const idNumber = parseInt(questionId.replace("Q_J_", ""));

      // å£²æ›é‡‘ãƒ»è²·æ›é‡‘é–¢é€£ã®å€‹åˆ¥åŒ–
      if (questionText.includes("å£²æ›é‡‘")) {
        if (amounts.length > 0) {
          return `å£²æ›é‡‘${amounts[0]}ã®å‡¦ç†ã€‚å‚µæ¨©ã®ç™ºç”Ÿãƒ»å›åãƒ»æ¶ˆæ»…ã‚’é©åˆ‡ã«è¨˜éŒ²ã—ã¾ã™ã€‚å£²æ›é‡‘ã¯è³‡ç”£ç§‘ç›®ã¨ã—ã¦å€Ÿæ–¹ã«è¨ˆä¸Šã—ã€å›åæ™‚ã¯è²¸æ–¹ã§æ¸›å°‘ã•ã›ã¾ã™ã€‚${questionId}ç‰¹æœ‰ã®å–å¼•å†…å®¹ã«å¿œã˜ãŸå‡¦ç†ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚`;
        }
        return `å£²æ›é‡‘ã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚å•†å“å£²ä¸Šã«ã‚ˆã‚‹å‚µæ¨©ç™ºç”Ÿã‹ã‚‰å›åã¾ã§ã®ä¸€é€£ã®æµã‚Œã‚’ç†è§£ã—ã€å£²æ›é‡‘å‹˜å®šã®å¢—æ¸›ã‚’æ­£ç¢ºã«å‡¦ç†ã—ã¦ãã ã•ã„ã€‚`;
      }

      // è²·æ›é‡‘é–¢é€£ã®å€‹åˆ¥åŒ–
      if (questionText.includes("è²·æ›é‡‘")) {
        if (amounts.length > 0) {
          return `è²·æ›é‡‘${amounts[0]}ã®å‡¦ç†ã€‚å‚µå‹™ã®ç™ºç”Ÿãƒ»æ”¯æ‰•ãƒ»æ¶ˆæ»…ã‚’é©åˆ‡ã«è¨˜éŒ²ã—ã¾ã™ã€‚è²·æ›é‡‘ã¯è² å‚µç§‘ç›®ã¨ã—ã¦è²¸æ–¹ã«è¨ˆä¸Šã—ã€æ”¯æ‰•æ™‚ã¯å€Ÿæ–¹ã§æ¸›å°‘ã•ã›ã¾ã™ã€‚${questionId}ã®å–å¼•ç‰¹æ€§ã«å¿œã˜ã¦å‡¦ç†ã—ã¦ãã ã•ã„ã€‚`;
        }
        return `è²·æ›é‡‘ã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚å•†å“ä»•å…¥ã«ã‚ˆã‚‹å‚µå‹™ç™ºç”Ÿã‹ã‚‰æ”¯æ‰•ã¾ã§ã®æµã‚Œã‚’ç†è§£ã—ã€è²·æ›é‡‘å‹˜å®šã®å¢—æ¸›ã‚’æ­£ç¢ºã«å‡¦ç†ã—ã¦ãã ã•ã„ã€‚`;
      }

      // å°åˆ‡æ‰‹é–¢é€£ã®å€‹åˆ¥åŒ–
      if (questionText.includes("å°åˆ‡æ‰‹")) {
        if (questionText.includes("æŒ¯å‡º")) {
          return `å°åˆ‡æ‰‹æŒ¯å‡ºã«ã‚ˆã‚‹æ”¯æ‰•ã„å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚å½“åº§é é‡‘ã®æ¸›å°‘ã¨ã—ã¦å‡¦ç†ã—ã€æŒ¯å‡ºã—ãŸå°åˆ‡æ‰‹ãŒéŠ€è¡Œã§æ±ºæ¸ˆã•ã‚Œã‚‹ã¾ã§ã®æ™‚é–“å·®ã‚’ç†è§£ã—ã¦ãã ã•ã„ã€‚å½“åº§é é‡‘æ®‹é«˜ä¸è¶³æ™‚ã¯å½“åº§å€Ÿè¶Šã®å‡¦ç†ã‚‚å¿…è¦ã§ã™ã€‚`;
        } else {
          return `å°åˆ‡æ‰‹å—å–ã«ã‚ˆã‚‹ä»£é‡‘å›åï¼ˆ${questionId}ï¼‰ã€‚ä»–åº—æŒ¯å‡ºå°åˆ‡æ‰‹ã¯é€šè²¨ä»£ç”¨è¨¼åˆ¸ã¨ã—ã¦ã€Œç¾é‡‘ã€ã§å‡¦ç†ã—ã€å³æ—¥éŠ€è¡Œã«æŒå‚ã—ã¦ç¾é‡‘åŒ–ã™ã‚‹ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚`;
        }
      }

      // æ‰‹å½¢é–¢é€£ã®å€‹åˆ¥åŒ–
      if (questionText.includes("æ‰‹å½¢")) {
        if (questionText.includes("å—å–")) {
          return `ç´„æŸæ‰‹å½¢å—å–ã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚${amounts.length > 0 ? amounts[0] + "ã®" : ""}å°†æ¥ã®ç¾é‡‘å—å–æ¨©åˆ©ã¨ã—ã¦ã€Œå—å–æ‰‹å½¢ã€ã§å‡¦ç†ã—ã¾ã™ã€‚æº€æœŸæ—¥ã¾ã§ä¿ç®¡ã—ã€æœŸæ—¥ã«ç¾é‡‘åŒ–ã¾ãŸã¯å–ç«‹å§”è¨—ã‚’è¡Œã„ã¾ã™ã€‚`;
        } else if (questionText.includes("æŒ¯å‡º")) {
          return `ç´„æŸæ‰‹å½¢æŒ¯å‡ºã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚${amounts.length > 0 ? amounts[0] + "ã®" : ""}å°†æ¥ã®ç¾é‡‘æ”¯æ‰•ç¾©å‹™ã¨ã—ã¦ã€Œæ”¯æ‰•æ‰‹å½¢ã€ã§å‡¦ç†ã—ã¾ã™ã€‚æº€æœŸæ—¥ã«å½“åº§é é‡‘ã‹ã‚‰è‡ªå‹•çš„ã«æ”¯æ‰•ã‚ã‚Œã¾ã™ã€‚`;
        }
      }

      // ç¾é‡‘é–¢é€£ã®å€‹åˆ¥åŒ–
      if (questionText.includes("ç¾é‡‘")) {
        const cashAmount = amounts.length > 0 ? amounts[0] : "";
        if (questionText.includes("éä¸è¶³")) {
          return `ç¾é‡‘éä¸è¶³ã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚${cashAmount}ã®ç¾é‡‘éä¸è¶³ã«ã¤ã„ã¦ã€å®ŸæŸ»çµæœã¨å¸³ç°¿æ®‹é«˜ã®å·®é¡ã‚’ã€Œç¾é‡‘éä¸è¶³ã€ã§èª¿æ•´ã—ã¾ã™ã€‚åŸå› åˆ¤æ˜æ™‚ã¯è©²å½“å‹˜å®šã«æŒ¯æ›¿ã€æ±ºç®—æ™‚ã«åŸå› ä¸æ˜åˆ†ã¯é›‘æãƒ»é›‘ç›Šã§å‡¦ç†ã—ã¾ã™ã€‚`;
        } else if (questionText.includes("è²¸ä»˜")) {
          return `ç¾é‡‘è²¸ä»˜ã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚${cashAmount}ã®è²¸ä»˜ã«ã‚ˆã‚Šã€Œè²¸ä»˜é‡‘ã€ï¼ˆè³‡ç”£ï¼‰ãŒç™ºç”Ÿã—ã€ã€Œç¾é‡‘ã€ï¼ˆè³‡ç”£ï¼‰ãŒæ¸›å°‘ã—ã¾ã™ã€‚åˆ©æ¯ãŒç™ºç”Ÿã™ã‚‹å ´åˆã¯ã€Œå—å–åˆ©æ¯ã€ã¨ã—ã¦åç›Šè¨ˆä¸Šã—ã¾ã™ã€‚`;
        } else {
          return `ç¾é‡‘å–å¼•ã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚${cashAmount}ã®ç¾é‡‘å¢—æ¸›ã‚’æ­£ç¢ºã«è¨˜éŒ²ã—ã€ç¾é‡‘å‹˜å®šã®å€Ÿæ–¹ãƒ»è²¸æ–¹ã¸ã®è¨ˆä¸Šã‚’é©åˆ‡ã«è¡Œã£ã¦ãã ã•ã„ã€‚ç¾é‡‘ã¯æœ€ã‚‚æµå‹•æ€§ã®é«˜ã„è³‡ç”£ã§ã™ã€‚`;
        }
      }

      // å•†å“å£²è²·é–¢é€£ã®å€‹åˆ¥åŒ–
      if (questionText.includes("å£²ä¸Š") && questionText.includes("å•†å“")) {
        return `å•†å“å£²ä¸Šã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚${amounts.length > 0 ? amounts[0] + "ã®" : ""}å£²ä¸Šã«ã¤ã„ã¦ä¸‰åˆ†æ³•ã«ã‚ˆã‚Šå‡¦ç†ã—ã¾ã™ã€‚ç¾é‡‘å£²ä¸Šã‹æ›å£²ä¸Šã‹ã«ã‚ˆã‚Šç›¸æ‰‹å‹˜å®šãŒã€Œç¾é‡‘ã€ã‹ã€Œå£²æ›é‡‘ã€ã«å¤‰ã‚ã‚Šã¾ã™ã€‚è¿”å“ãƒ»å€¤å¼•ãã¯é€†ä»•è¨³ã§å‡¦ç†ã—ã¦ãã ã•ã„ã€‚`;
      }

      if (questionText.includes("ä»•å…¥") && questionText.includes("å•†å“")) {
        return `å•†å“ä»•å…¥ã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚${amounts.length > 0 ? amounts[0] + "ã®" : ""}ä»•å…¥ã«ã¤ã„ã¦ä¸‰åˆ†æ³•ã«ã‚ˆã‚Šå‡¦ç†ã—ã¾ã™ã€‚ç¾é‡‘ä»•å…¥ã‹æ›ä»•å…¥ã‹ã«ã‚ˆã‚Šç›¸æ‰‹å‹˜å®šãŒã€Œç¾é‡‘ã€ã‹ã€Œè²·æ›é‡‘ã€ã«å¤‰ã‚ã‚Šã¾ã™ã€‚è¿”å“ãƒ»å€¤å¼•ãã¯é€†ä»•è¨³ã§å‡¦ç†ã—ã¦ãã ã•ã„ã€‚`;
      }

      // çµ¦æ–™é–¢é€£ã®å€‹åˆ¥åŒ–
      if (questionText.includes("çµ¦æ–™") || questionText.includes("çµ¦ä¸")) {
        return `çµ¦æ–™æ”¯æ‰•ã„ã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚${amounts.length > 0 ? amounts[0] + "ã®" : ""}çµ¦æ–™ã«ã¤ã„ã¦ã€ç·æ”¯çµ¦é¡ã‚’ã€Œçµ¦æ–™ã€ã§è²»ç”¨è¨ˆä¸Šã—ã€æºæ³‰ç¨ãƒ»ä½æ°‘ç¨ãƒ»ç¤¾ä¼šä¿é™ºæ–™ã®å¤©å¼•ãåˆ†ã¯ã€Œé ã‚Šé‡‘ã€ã§å‡¦ç†ã—ã¾ã™ã€‚å®Ÿéš›ã®æ”¯çµ¦é¡ã¯ç¾é‡‘ã§æ”¯æ‰•ã„ã¾ã™ã€‚`;
      }

      // ä¿é™ºæ–™é–¢é€£ã®å€‹åˆ¥åŒ–
      if (questionText.includes("ä¿é™ºæ–™")) {
        return `ä¿é™ºæ–™æ”¯æ‰•ã„ã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚${amounts.length > 0 ? amounts[0] + "ã®" : ""}ä¿é™ºæ–™ã«ã¤ã„ã¦ã€æ”¯æ‰•æ™‚ã¯ã€Œä¿é™ºæ–™ã€ã§è²»ç”¨è¨ˆä¸Šã—ã¾ã™ã€‚æ±ºç®—æ™‚ã«æœªçµŒéåˆ†ï¼ˆç¿ŒæœŸä»¥é™ã®ä¿é™ºæœŸé–“åˆ†ï¼‰ã¯ã€Œå‰æ‰•ä¿é™ºæ–™ã€ã¨ã—ã¦è³‡ç”£è¨ˆä¸Šã—ã€è²»ç”¨ã®æœŸé–“é…åˆ†ã‚’è¡Œã„ã¾ã™ã€‚`;
      }

      // æ¸›ä¾¡å„Ÿå´é–¢é€£ã®å€‹åˆ¥åŒ–
      if (questionText.includes("æ¸›ä¾¡å„Ÿå´")) {
        return `æ¸›ä¾¡å„Ÿå´ã®å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚${amounts.length > 0 ? amounts[0] + "ç›¸å½“ã®" : ""}å›ºå®šè³‡ç”£ä¾¡å€¤æ¸›å°‘ã‚’è²»ç”¨åŒ–ã—ã¾ã™ã€‚é–“æ¥æ³•ã§ã¯ã€Œæ¸›ä¾¡å„Ÿå´è²»ã€ï¼ˆè²»ç”¨ï¼‰ã¨ã€Œæ¸›ä¾¡å„Ÿå´ç´¯è¨ˆé¡ã€ï¼ˆè³‡ç”£ã®ãƒã‚¤ãƒŠã‚¹å‹˜å®šï¼‰ã‚’ä½¿ç”¨ã—ã€è³‡ç”£ã®å¸³ç°¿ä¾¡é¡ã¯å–å¾—åŸä¾¡ã‹ã‚‰ç´¯è¨ˆé¡ã‚’æ§é™¤ã—ãŸé‡‘é¡ã¨ãªã‚Šã¾ã™ã€‚`;
      }

      // è²¸å€’é–¢é€£ã®å€‹åˆ¥åŒ–
      if (questionText.includes("è²¸å€’")) {
        return `è²¸å€’å‡¦ç†ï¼ˆ${questionId}ï¼‰ã€‚${amounts.length > 0 ? amounts[0] + "ã®" : ""}å‚µæ¨©å›åä¸èƒ½ã«ã¤ã„ã¦ã€å¼•å½“é‡‘æ–¹å¼ã§ã¯ã€Œè²¸å€’å¼•å½“é‡‘ç¹°å…¥é¡ã€ï¼ˆè²»ç”¨ï¼‰ã¨ã€Œè²¸å€’å¼•å½“é‡‘ã€ï¼ˆè³‡ç”£ã®ãƒã‚¤ãƒŠã‚¹å‹˜å®šï¼‰ã€ç›´æ¥å„Ÿå´æ³•ã§ã¯ã€Œè²¸å€’æå¤±ã€ï¼ˆè²»ç”¨ï¼‰ã¨ã€Œå£²æ›é‡‘ã€ï¼ˆè³‡ç”£ã®æ¸›å°‘ï¼‰ã§å‡¦ç†ã—ã¾ã™ã€‚`;
      }

      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å€‹åˆ¥åŒ–ï¼ˆå•é¡ŒIDåŸºæº–ï¼‰
      if (idNumber <= 50) {
        return `ä»•è¨³åŸºç¤å•é¡Œï¼ˆ${questionId}ï¼‰ã€‚åŸºæœ¬çš„ãªå–å¼•ã®ä»•è¨³å‡¦ç†ã§ã™ã€‚å‹˜å®šç§‘ç›®ã®æ€§è³ªï¼ˆè³‡ç”£ãƒ»è² å‚µãƒ»ç´”è³‡ç”£ãƒ»åç›Šãƒ»è²»ç”¨ï¼‰ã‚’ç†è§£ã—ã€å€Ÿæ–¹ãƒ»è²¸æ–¹ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦æ­£ç¢ºã«å‡¦ç†ã—ã¦ãã ã•ã„ã€‚`;
      } else if (idNumber <= 100) {
        return `ä»•è¨³å¿œç”¨å•é¡Œï¼ˆ${questionId}ï¼‰ã€‚ã‚„ã‚„è¤‡é›‘ãªå–å¼•ã®ä»•è¨³å‡¦ç†ã§ã™ã€‚è¤‡æ•°ã®å‹˜å®šç§‘ç›®ãŒé–¢é€£ã™ã‚‹å ´åˆã¯ã€å„ç§‘ç›®ã®é‡‘é¡é…åˆ†ã«æ³¨æ„ã—ã€å€Ÿæ–¹åˆè¨ˆã¨è²¸æ–¹åˆè¨ˆã‚’ä¸€è‡´ã•ã›ã¦ãã ã•ã„ã€‚`;
      } else if (idNumber <= 150) {
        return `ä»•è¨³ç™ºå±•å•é¡Œï¼ˆ${questionId}ï¼‰ã€‚å®Ÿå‹™çš„ãªå–å¼•ã®ä»•è¨³å‡¦ç†ã§ã™ã€‚å–å¼•ã®çµŒæ¸ˆçš„å®Ÿè³ªã‚’ç†è§£ã—ã€é©åˆ‡ãªä¼šè¨ˆå‡¦ç†ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚æ±ºç®—æ•´ç†äº‹é …ã‚‚å«ã‚€å ´åˆãŒã‚ã‚Šã¾ã™ã€‚`;
      } else {
        return `ä»•è¨³ç·åˆå•é¡Œï¼ˆ${questionId}ï¼‰ã€‚ç·åˆçš„ãªä»•è¨³å‡¦ç†èƒ½åŠ›ã‚’å•ã†å•é¡Œã§ã™ã€‚ã“ã‚Œã¾ã§å­¦ç¿’ã—ãŸä»•è¨³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¿œç”¨ã—ã€æ­£ç¢ºã‹ã¤è¿…é€Ÿã«å‡¦ç†ã—ã¦ãã ã•ã„ã€‚å®Ÿå‹™ãƒ¬ãƒ™ãƒ«ã®åˆ¤æ–­åŠ›ãŒå¿…è¦ã§ã™ã€‚`;
      }
    }

    // ç¬¬2å•ï¼ˆå¸³ç°¿å•é¡Œï¼‰ã®å€‹åˆ¥åŒ–
    else if (questionId.startsWith("Q_L_")) {
      const idNumber = parseInt(questionId.replace("Q_L_", ""));

      if (questionText.includes("ç·å‹˜å®šå…ƒå¸³")) {
        return `ç·å‹˜å®šå…ƒå¸³è¨˜å…¥ï¼ˆ${questionId}ï¼‰ã€‚ä»•è¨³å¸³ã®å„ä»•è¨³ã‚’å‹˜å®šç§‘ç›®åˆ¥ã«è»¢è¨˜ã—ã¾ã™ã€‚å€Ÿæ–¹ãƒ»è²¸æ–¹ã®é‡‘é¡ã¨å¹´æœˆæ—¥ã€æ‘˜è¦ï¼ˆç›¸æ‰‹å‹˜å®šï¼‰ã‚’æ­£ç¢ºã«è¨˜å…¥ã—ã€å„å‹˜å®šã®æ®‹é«˜ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚è»¢è¨˜æ¼ã‚Œã‚„è»¢è¨˜èª¤ã‚Šã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚`;
      } else if (questionText.includes("ç¾é‡‘å‡ºç´å¸³")) {
        return `ç¾é‡‘å‡ºç´å¸³è¨˜å…¥ï¼ˆ${questionId}ï¼‰ã€‚ç¾é‡‘ã®åå…¥ï¼ˆå€Ÿæ–¹å–å¼•ï¼‰ã¨æ”¯å‡ºï¼ˆè²¸æ–¹å–å¼•ï¼‰ã‚’æ™‚ç³»åˆ—ã§è¨˜éŒ²ã—ã¾ã™ã€‚å–å¼•å¹´æœˆæ—¥ã€æ‘˜è¦ã€é‡‘é¡ã‚’æ­£ç¢ºã«è¨˜å…¥ã—ã€ç¾é‡‘æ®‹é«˜ã‚’é€æ¬¡è¨ˆç®—ã—ã¦ãã ã•ã„ã€‚ç¾é‡‘å®ŸæŸ»ã¨ã®ç…§åˆã‚‚é‡è¦ã§ã™ã€‚`;
      } else if (questionText.includes("å£²ä¸Šå¸³")) {
        return `å£²ä¸Šå¸³è¨˜å…¥ï¼ˆ${questionId}ï¼‰ã€‚å¾—æ„å…ˆåˆ¥ã®æ›å£²ä¸Šã‚’è¨˜éŒ²ã™ã‚‹è£œåŠ©ç°¿ã§ã™ã€‚å£²ä¸Šå¹´æœˆæ—¥ã€å¾—æ„å…ˆåã€å•†å“åã€é‡‘é¡ã‚’è¨˜å…¥ã—ã€è¿”å“ãƒ»å€¤å¼•ãã¯â–³å°ã§è¡¨ç¤ºã—ã¾ã™ã€‚å£²æ›é‡‘ç®¡ç†ã®åŸºç¤è³‡æ–™ã¨ãªã‚Šã¾ã™ã€‚`;
      } else if (questionText.includes("ä»•å…¥å¸³")) {
        return `ä»•å…¥å¸³è¨˜å…¥ï¼ˆ${questionId}ï¼‰ã€‚ä»•å…¥å…ˆåˆ¥ã®æ›ä»•å…¥ã‚’è¨˜éŒ²ã™ã‚‹è£œåŠ©ç°¿ã§ã™ã€‚ä»•å…¥å¹´æœˆæ—¥ã€ä»•å…¥å…ˆåã€å•†å“åã€é‡‘é¡ã‚’è¨˜å…¥ã—ã€è¿”å“ãƒ»å€¤å¼•ãã¯â–³å°ã§è¡¨ç¤ºã—ã¾ã™ã€‚è²·æ›é‡‘ç®¡ç†ã®åŸºç¤è³‡æ–™ã¨ãªã‚Šã¾ã™ã€‚`;
      } else if (questionText.includes("å•†å“æœ‰é«˜å¸³")) {
        return `å•†å“æœ‰é«˜å¸³è¨˜å…¥ï¼ˆ${questionId}ï¼‰ã€‚å•†å“ã®å—å…¥ãƒ»æ‰•å‡ºãƒ»æ®‹é«˜ã‚’ç¶™ç¶šè¨˜éŒ²ã—ã¾ã™ã€‚å…ˆå…¥å…ˆå‡ºæ³•ã¾ãŸã¯ç§»å‹•å¹³å‡æ³•ã«ã‚ˆã‚Šæ‰•å‡ºå˜ä¾¡ã‚’è¨ˆç®—ã—ã€æ•°é‡ã¨é‡‘é¡ã®ä¸¡æ–¹ã§åœ¨åº«ç®¡ç†ã‚’è¡Œã„ã¾ã™ã€‚æ£šå¸è³‡ç”£ç®¡ç†ã®ä¸­æ ¸ã¨ãªã‚‹å¸³ç°¿ã§ã™ã€‚`;
      } else if (questionText.includes("å—å–æ‰‹å½¢è¨˜å…¥å¸³")) {
        return `å—å–æ‰‹å½¢è¨˜å…¥å¸³è¨˜å…¥ï¼ˆ${questionId}ï¼‰ã€‚ç´„æŸæ‰‹å½¢ã®å—å–ã‹ã‚‰æ±ºæ¸ˆã¾ã§ã‚’ç®¡ç†ã—ã¾ã™ã€‚æŒ¯å‡ºäººã€æ”¯æ‰•äººã€é‡‘é¡ã€æº€æœŸæ—¥ã€æ±ºæ¸ˆçŠ¶æ³ã‚’è¨˜éŒ²ã—ã€ä¸æ¸¡æ‰‹å½¢ã®å‡¦ç†ã‚‚å«ã¿ã¾ã™ã€‚æ‰‹å½¢ç®¡ç†ã®é‡è¦ãªè£œåŠ©ç°¿ã§ã™ã€‚`;
      } else if (questionText.includes("æ”¯æ‰•æ‰‹å½¢è¨˜å…¥å¸³")) {
        return `æ”¯æ‰•æ‰‹å½¢è¨˜å…¥å¸³è¨˜å…¥ï¼ˆ${questionId}ï¼‰ã€‚ç´„æŸæ‰‹å½¢ã®æŒ¯å‡ºã‹ã‚‰æ±ºæ¸ˆã¾ã§ã‚’ç®¡ç†ã—ã¾ã™ã€‚å—å–äººã€æ”¯æ‰•éŠ€è¡Œã€é‡‘é¡ã€æº€æœŸæ—¥ã€æ±ºæ¸ˆçŠ¶æ³ã‚’è¨˜éŒ²ã—ã€æ”¯æ‰•è³‡é‡‘ã®æº–å‚™ã‚‚è€ƒæ…®ã—ã¾ã™ã€‚æ‰‹å½¢ç®¡ç†ã®é‡è¦ãªè£œåŠ©ç°¿ã§ã™ã€‚`;
      } else {
        return `å¸³ç°¿è¨˜å…¥å•é¡Œï¼ˆ${questionId}ï¼‰ã€‚å„ç¨®å¸³ç°¿ã®ç‰¹æ€§ã‚’ç†è§£ã—ã€è¨˜å¸³ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦æ­£ç¢ºã«è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚ä¸»è¦ç°¿ã¨è£œåŠ©ç°¿ã®é–¢ä¿‚ã€å„å¸³ç°¿ã®è¨˜å…¥é …ç›®ã¨è¨ˆç®—æ–¹æ³•ã‚’æŠŠæ¡ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚`;
      }
    }

    // ç¬¬3å•ï¼ˆè¡¨ä½œæˆå•é¡Œï¼‰ã®å€‹åˆ¥åŒ–
    else if (questionId.startsWith("Q_T_")) {
      const idNumber = parseInt(questionId.replace("Q_T_", ""));

      if (questionText.includes("åˆè¨ˆè©¦ç®—è¡¨")) {
        return `åˆè¨ˆè©¦ç®—è¡¨ä½œæˆï¼ˆ${questionId}ï¼‰ã€‚å„å‹˜å®šç§‘ç›®ã®æœŸä¸­å€Ÿæ–¹åˆè¨ˆãƒ»è²¸æ–¹åˆè¨ˆã‚’é›†è¨ˆã—ã€å…¨ä½“ã®å€Ÿæ–¹åˆè¨ˆã¨è²¸æ–¹åˆè¨ˆãŒä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚ä»•è¨³ã®æ­£ç¢ºæ€§ã‚’æ¤œè¨¼ã™ã‚‹é‡è¦ãªæ‰‹ç¶šãã§ã™ã€‚è¨ˆç®—ãƒŸã‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚`;
      } else if (questionText.includes("æ®‹é«˜è©¦ç®—è¡¨")) {
        return `æ®‹é«˜è©¦ç®—è¡¨ä½œæˆï¼ˆ${questionId}ï¼‰ã€‚å„å‹˜å®šç§‘ç›®ã®æœŸæœ«æ®‹é«˜ã‚’ç®—å®šã—ã€å€Ÿæ–¹æ®‹é«˜ãƒ»è²¸æ–¹æ®‹é«˜ã«åˆ†é¡ã—ã¾ã™ã€‚å€Ÿæ–¹æ®‹é«˜åˆè¨ˆã¨è²¸æ–¹æ®‹é«˜åˆè¨ˆã®ä¸€è‡´ã‚’ç¢ºèªã—ã€è²¸å€Ÿå¯¾ç…§è¡¨ä½œæˆã®åŸºç¤è³‡æ–™ã¨ã—ã¾ã™ã€‚`;
      } else if (questionText.includes("ç²¾ç®—è¡¨")) {
        return `ç²¾ç®—è¡¨ä½œæˆï¼ˆ${questionId}ï¼‰ã€‚è©¦ç®—è¡¨ã«æ±ºç®—æ•´ç†äº‹é …ã‚’åæ˜ ã•ã›ã€æç›Šè¨ˆç®—æ›¸é …ç›®ã¨è²¸å€Ÿå¯¾ç…§è¡¨é …ç›®ã«åˆ†é¡ã—ã¾ã™ã€‚å„æ¬„ã®åˆè¨ˆãŒä¸€è‡´ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€æ±ºç®—æ›¸ä½œæˆã®æº–å‚™ã‚’è¡Œã„ã¾ã™ã€‚`;
      } else if (questionText.includes("æç›Šè¨ˆç®—æ›¸")) {
        return `æç›Šè¨ˆç®—æ›¸ä½œæˆï¼ˆ${questionId}ï¼‰ã€‚åç›Šãƒ»è²»ç”¨ã‚’é©åˆ‡ã«åˆ†é¡ã—ã€å£²ä¸Šç·åˆ©ç›Šã€å–¶æ¥­åˆ©ç›Šã€çµŒå¸¸åˆ©ç›Šã€å½“æœŸç´”åˆ©ç›Šã®æ®µéšåˆ©ç›Šã‚’ç®—å‡ºã—ã¾ã™ã€‚åç›Šè²»ç”¨å¯¾å¿œã®åŸå‰‡ã«å¾“ã„ã€æœŸé–“æ¥­ç¸¾ã‚’æ­£ç¢ºã«è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚`;
      } else if (questionText.includes("è²¸å€Ÿå¯¾ç…§è¡¨")) {
        return `è²¸å€Ÿå¯¾ç…§è¡¨ä½œæˆï¼ˆ${questionId}ï¼‰ã€‚è³‡ç”£ãƒ»è² å‚µãƒ»ç´”è³‡ç”£ã‚’æµå‹•ãƒ»å›ºå®šã«åˆ†é¡ã—ã€è²¡æ”¿çŠ¶æ…‹ã‚’æ˜ç¤ºã—ã¾ã™ã€‚è³‡ç”£åˆè¨ˆã¨è² å‚µãƒ»ç´”è³‡ç”£åˆè¨ˆã‚’ä¸€è‡´ã•ã›ã€æµå‹•æ¯”ç‡ç­‰ã®è²¡å‹™æŒ‡æ¨™ç®—å‡ºã®åŸºç¤è³‡æ–™ã¨ã—ã¾ã™ã€‚`;
      } else {
        return `è¡¨ä½œæˆå•é¡Œï¼ˆ${questionId}ï¼‰ã€‚å„ç¨®è²¡å‹™è«¸è¡¨ãƒ»è©¦ç®—è¡¨ã®ä½œæˆæŠ€æ³•ã‚’ç¿’å¾—ã—ã¦ãã ã•ã„ã€‚è¨ˆç®—ã®æ­£ç¢ºæ€§ã€åˆ†é¡ã®é©åˆ‡æ€§ã€è¡¨ç¤ºã®å®Œå…¨æ€§ã«æ³¨æ„ã—ã€ç°¿è¨˜ã®ç·åˆçš„ãªç†è§£ã‚’æ·±ã‚ã¾ã™ã€‚`;
      }
    }

    return `å€‹åˆ¥å•é¡Œï¼ˆ${questionId}ï¼‰ã€‚å•é¡Œå›ºæœ‰ã®ç‰¹æ€§ã‚’ç†è§£ã—ã€ç°¿è¨˜ã®åŸºæœ¬åŸå‰‡ã«å¾“ã£ã¦æ­£ç¢ºã«å‡¦ç†ã—ã¦ãã ã•ã„ã€‚`;
  } catch (error) {
    return `å•é¡Œ${questionId}ã®å€‹åˆ¥å‡¦ç†ã€‚å–å¼•å†…å®¹ã‚’ç†è§£ã—ã€é©åˆ‡ãªä¼šè¨ˆå‡¦ç†ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚`;
  }
}

// é‡è¤‡è§£èª¬ã‚’å€‹åˆ¥åŒ–
let updatedCount = 0;
const updatedQuestions = [];

duplicates.forEach(([originalExplanation, questionList]) => {
  console.log(
    `ğŸ“ "${originalExplanation.substring(0, 50)}..." ã®${questionList.length}å•ã‚’å€‹åˆ¥åŒ–ä¸­...`,
  );

  questionList.forEach((question, index) => {
    const newExplanation = generateUniqueExplanation(
      question,
      index,
      questionList.length,
    );

    if (newExplanation !== question.explanation) {
      const oldExplanation = question.explanation;
      question.explanation = newExplanation;
      updatedCount++;

      updatedQuestions.push({
        id: question.id,
        questionText: question.question_text.substring(0, 40) + "...",
        oldExplanation: oldExplanation,
        newExplanation: newExplanation,
      });
    }
  });
});

// TypeScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†æ§‹ç¯‰
const beforeData = content.substring(0, startIndex);
const afterData = content.substring(endIndex);

// å…ƒã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æˆ»ã™
const formattedQuestions = questions
  .map((q) => {
    // explanationãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
    const escapedExplanation = q.explanation
      .replace(/\\/g, "\\\\")
      .replace(/"/g, '\\"')
      .replace(/\n/g, "\\n");

    return `  {
    id: "${q.id}",
    category_id: "${q.category_id}",
    difficulty: ${q.difficulty},
    question_text: "${q.question_text.replace(/"/g, '\\"').replace(/\n/g, "\\n")}",
    answer_template_json: "${q.answer_template_json.replace(/"/g, '\\"')}",
    correct_answer_json: "${q.correct_answer_json.replace(/"/g, '\\"')}",
    explanation: "${escapedExplanation}",
    tags_json: "${q.tags_json.replace(/"/g, '\\"')}",
    created_at: "${q.created_at}",
    updated_at: "${q.updated_at}"
  }`;
  })
  .join(",\n");

const newContent = beforeData + "[\n" + formattedQuestions + "\n]" + afterData;
fs.writeFileSync(tsFilePath, newContent, "utf8");

console.log(`\nâœ… ${updatedCount}å•ã®é‡è¤‡è§£èª¬ã‚’å€‹åˆ¥åŒ–ã—ã¾ã—ãŸï¼\n`);

// æ›´æ–°ã•ã‚ŒãŸè§£èª¬ã®ä¾‹ã‚’è¡¨ç¤º
console.log("ğŸ¯ å€‹åˆ¥åŒ–ã•ã‚ŒãŸè§£èª¬ã®ä¾‹:\n");

updatedQuestions.slice(0, 8).forEach((item, index) => {
  console.log(`${index + 1}. ${item.id}:`);
  console.log(`   å•é¡Œ: ${item.questionText}`);
  console.log(`   æ—§è§£èª¬: ${item.oldExplanation.substring(0, 50)}...`);
  console.log(`   æ–°è§£èª¬: ${item.newExplanation.substring(0, 60)}...`);
  console.log("");
});

if (updatedQuestions.length > 8) {
  console.log(`   ... ä»– ${updatedQuestions.length - 8}å•ã‚‚å€‹åˆ¥åŒ–å®Œäº†\n`);
}

console.log("âœ¨ é‡è¤‡è§£èª¬ã®å®Œå…¨æ’é™¤ãŒå®Œäº†ã—ã¾ã—ãŸï¼");
console.log("ğŸ“ˆ æ”¹å–„å†…å®¹:");
console.log("  - å…¨å•é¡ŒãŒå›ºæœ‰ã®è§£èª¬ã‚’æŒã¤ã‚ˆã†ã«å€‹åˆ¥åŒ–");
console.log("  - å•é¡ŒIDã¨å†…å®¹ã«åŸºã¥ãå…·ä½“çš„ãªè§£èª¬");
console.log("  - åŒä¸€è§£èª¬ã®å®Œå…¨æ’é™¤");
console.log("  - å„å•é¡Œã®ç‰¹æ€§ã‚’åæ˜ ã—ãŸå€‹åˆ¥æŒ‡å°");
