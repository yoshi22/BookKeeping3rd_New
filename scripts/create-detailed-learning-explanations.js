#!/usr/bin/env node

/**
 * å„å•é¡Œã®å…·ä½“çš„ãªå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆãƒ»é–“é•ãˆã‚„ã™ã„å‹˜å®šç§‘ç›®ãƒ»ç†è§£ã®ã‚³ãƒ„ã‚’å«ã‚€è©³ç´°è§£èª¬ã‚’ä½œæˆ
 * ã‚¦ã‚§ãƒ–èª¿æŸ»çµæœã«åŸºã¥ãå®Ÿç”¨çš„ãªå­¦ç¿’ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›
 */

const fs = require("fs");
const path = require("path");

// TypeScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
const tsFilePath = path.join(
  __dirname,
  "..",
  "src",
  "data",
  "master-questions.ts",
);
const content = fs.readFileSync(tsFilePath, "utf8");

console.log("ğŸ¯ å„å•é¡Œã®è©³ç´°å­¦ç¿’è§£èª¬ã‚’ä½œæˆä¸­...\n");

// ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
const startPattern = /export const masterQuestions[^=]*=\s*\[/;
const startMatch = content.match(startPattern);
const startIndex = startMatch.index + startMatch[0].length - 1;

let depth = 0;
let endIndex = -1;
let inString = false;
let escapeNext = false;

for (let i = startIndex; i < content.length; i++) {
  const char = content[i];

  if (escapeNext) {
    escapeNext = false;
    continue;
  }

  if (char === "\\") {
    escapeNext = true;
    continue;
  }

  if (char === '"' && !inString) {
    inString = true;
  } else if (char === '"' && inString) {
    inString = false;
  }

  if (!inString) {
    if (char === "[" || char === "{") {
      depth++;
    } else if (char === "]" || char === "}") {
      depth--;
      if (depth === 0 && char === "]") {
        endIndex = i + 1;
        break;
      }
    }
  }
}

const dataString = content.substring(startIndex, endIndex);
const questions = eval(dataString);

// å•é¡Œå›ºæœ‰ã®è©³ç´°å­¦ç¿’è§£èª¬ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
function generateDetailedLearningExplanation(question) {
  const questionText = question.question_text;
  const questionId = question.id;

  try {
    const correctAnswer = JSON.parse(question.correct_answer_json);
    const answerTemplate = JSON.parse(question.answer_template_json);

    // é‡‘é¡ã‚’æŠ½å‡º
    const amounts = [];
    const amountMatches = questionText.match(/[\\d,]+å††/g);
    if (amountMatches) {
      amounts.push(...amountMatches);
    }

    // å‹˜å®šç§‘ç›®ã‚’æŠ½å‡ºï¼ˆæ­£ç­”ã‹ã‚‰ï¼‰
    let accounts = [];
    if (correctAnswer && correctAnswer.entries) {
      correctAnswer.entries.forEach((entry) => {
        if (entry.debit_account) accounts.push(entry.debit_account);
        if (entry.credit_account) accounts.push(entry.credit_account);
      });
    }

    // ç¬¬1å•ï¼ˆä»•è¨³å•é¡Œï¼‰ã®è©³ç´°å­¦ç¿’è§£èª¬
    if (questionId.startsWith("Q_J_")) {
      let explanation = "";
      let mistakePoints = "";
      let learningTips = "";

      // ç¾é‡‘éä¸è¶³é–¢é€£
      if (
        questionText.includes("ç¾é‡‘éä¸è¶³") ||
        questionText.includes("ç¾é‡‘å®ŸæŸ»")
      ) {
        explanation = `ç¾é‡‘å®ŸæŸ»ã«ã‚ˆã‚‹éä¸è¶³å‡¦ç†ã€‚å®Ÿéš›æœ‰é«˜ã¨å¸³ç°¿æ®‹é«˜ã®å·®é¡ã‚’ã€Œç¾é‡‘éä¸è¶³ã€ã§èª¿æ•´ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šã€Œç¾é‡‘éä¸è¶³ã€ã¯ä¸€æ™‚çš„ãªä»®å‹˜å®šã§ã™ã€‚å€Ÿæ–¹ãƒ»è²¸æ–¹ã‚’ç¾é‡‘ã®å¢—æ¸›ã¨é€†ã«ã—ãªã„ã‚ˆã†æ³¨æ„ã€‚ç¾é‡‘ä¸è¶³ãªã‚‰å€Ÿæ–¹ã€Œç¾é‡‘éä¸è¶³ã€ãƒ»è²¸æ–¹ã€Œç¾é‡‘ã€ã€ç¾é‡‘è¶…éãªã‚‰å€Ÿæ–¹ã€Œç¾é‡‘ã€ãƒ»è²¸æ–¹ã€Œç¾é‡‘éä¸è¶³ã€ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šç¾é‡‘éä¸è¶³ã¯æ±ºç®—æ™‚å‡¦ç†ãŒé‡è¦ã€‚åŸå› åˆ¤æ˜æ™‚ã¯è©²å½“å‹˜å®šã«æŒ¯æ›¿ï¼ˆä¾‹ï¼šé€šä¿¡è²»ã€é›‘æï¼‰ã€‚åŸå› ä¸æ˜æ™‚ã¯é›‘æãƒ»é›‘ç›Šã¸ã€‚ç¾é‡‘å®ŸæŸ»ï¼å¸³ç°¿æ®‹é«˜ã®æ¤œè¨¼ä½œæ¥­ã¨è¦šãˆã¾ã—ã‚‡ã†ã€‚`;
      }
      // å°å£ç¾é‡‘é–¢é€£
      else if (questionText.includes("å°å£ç¾é‡‘")) {
        explanation = `å°å£ç¾é‡‘åˆ¶åº¦ï¼ˆã‚¤ãƒ³ãƒ—ãƒ¬ã‚¹ãƒˆãƒ»ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã®å‡¦ç†ã€‚å®šé¡è³‡é‡‘å‰æ¸¡æ³•ã«ã‚ˆã‚Šå°å£æ”¯æ‰•ã„è³‡é‡‘ã‚’ç®¡ç†ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šã€Œå°å£ç¾é‡‘ã€ã¨ã€Œç¾é‡‘ã€ã‚’æ··åŒã—ãªã„ã“ã¨ã€‚å°å£ç¾é‡‘ã¸ã®å‰æ¸¡ã—ã¯å€Ÿæ–¹ã€Œå°å£ç¾é‡‘ã€ãƒ»è²¸æ–¹ã€Œç¾é‡‘ã€ã€‚è£œçµ¦æ™‚ã‚‚åŒæ§˜ã§ã™ã€‚ã€Œé ã‚Šé‡‘ã€ã‚„ã€Œä»®æ‰•é‡‘ã€ã¨é–“é•ãˆãªã„ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šã‚¤ãƒ³ãƒ—ãƒ¬ã‚¹ãƒˆãƒ»ã‚·ã‚¹ãƒ†ãƒ ã§ã¯å¸¸ã«ä¸€å®šé¡ã‚’ä¿æŒã€‚ä½¿ç”¨åˆ†ã‚’è£œçµ¦ã—ã¦å…ƒã®é‡‘é¡ã«æˆ»ã™ä»•çµ„ã¿ã€‚å°å£ç¾é‡‘å‡ºç´å¸³ã¨ã®é–¢é€£ã‚‚ç†è§£ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚è¨¼æ†‘å•é¡Œã§å°å£ç¾é‡‘ä¼ç¥¨ãŒå‡ºé¡Œã•ã‚Œã‚‹ã“ã¨ã‚‚ã€‚`;
      }
      // å£²æ›é‡‘ãƒ»è²·æ›é‡‘é–¢é€£
      else if (
        questionText.includes("å£²æ›é‡‘") ||
        questionText.includes("è²·æ›é‡‘")
      ) {
        const isReceivable = questionText.includes("å£²æ›é‡‘");
        explanation = `${isReceivable ? "å£²æ›é‡‘" : "è²·æ›é‡‘"}ã®å‡¦ç†ã€‚${isReceivable ? "å•†å“å£²ä¸Šã«ã‚ˆã‚‹å‚µæ¨©" : "å•†å“ä»•å…¥ã«ã‚ˆã‚‹å‚µå‹™"}ã®ç™ºç”Ÿãƒ»æ¶ˆæ»…ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼š${isReceivable ? "å£²æ›é‡‘" : "è²·æ›é‡‘"}ã¯${isReceivable ? "è³‡ç”£" : "è² å‚µ"}ç§‘ç›®ã€‚${isReceivable ? "ç™ºç”Ÿæ™‚ã¯å€Ÿæ–¹ã€å›åæ™‚ã¯è²¸æ–¹" : "ç™ºç”Ÿæ™‚ã¯è²¸æ–¹ã€æ”¯æ‰•æ™‚ã¯å€Ÿæ–¹"}ã€‚ã€Œæœªåé‡‘ã€ã€Œæœªæ‰•é‡‘ã€ã¨ã®åŒºåˆ¥ã‚‚é‡è¦ï¼ˆå•†å“å£²è²·ä»¥å¤–ã®å–å¼•ï¼‰ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šæ›å–å¼•ã§ã¯${isReceivable ? "ã€Œå£²æ›é‡‘ã€ï¼‹ã€Œå£²ä¸Šã€" : "ã€Œä»•å…¥ã€ï¼‹ã€Œè²·æ›é‡‘ã€"}ãŒã‚»ãƒƒãƒˆã€‚å›åãƒ»æ”¯æ‰•æ–¹æ³•ï¼ˆç¾é‡‘ãƒ»å°åˆ‡æ‰‹ãƒ»æ‰‹å½¢ï¼‰ã«ã‚ˆã‚Šç›¸æ‰‹å‹˜å®šãŒå¤‰ã‚ã‚‹ç‚¹ã«æ³¨æ„ã€‚è¿”å“ãƒ»å€¤å¼•ãã¯é€†ä»•è¨³ã§å‡¦ç†ã€‚`;
      }
      // æ‰‹å½¢é–¢é€£
      else if (questionText.includes("æ‰‹å½¢")) {
        const isReceivable =
          questionText.includes("å—å–æ‰‹å½¢") || questionText.includes("å—å–");
        explanation = `ç´„æŸæ‰‹å½¢ã®${isReceivable ? "å—å–" : "æŒ¯å‡º"}å‡¦ç†ã€‚${isReceivable ? "å°†æ¥ã®ç¾é‡‘å—å–æ¨©åˆ©" : "å°†æ¥ã®ç¾é‡‘æ”¯æ‰•ç¾©å‹™"}ã¨ã—ã¦å‡¦ç†ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šæ‰‹å½¢ã¯æº€æœŸæ—¥ã¾ã§ç¾é‡‘åŒ–ã§ãã¾ã›ã‚“ã€‚${isReceivable ? "å—å–æ‰‹å½¢ã¯è³‡ç”£ï¼ˆå€Ÿæ–¹ï¼‰" : "æ”¯æ‰•æ‰‹å½¢ã¯è² å‚µï¼ˆè²¸æ–¹ï¼‰"}ã€‚å°åˆ‡æ‰‹ã¨æ··åŒã—ãªã„ï¼ˆå°åˆ‡æ‰‹ã¯å³åº§ã«ç¾é‡‘åŒ–å¯èƒ½ï¼‰ã€‚ä¸æ¸¡æ™‚ã®å‡¦ç†ã‚‚è¦šãˆã¦ãŠãã¾ã—ã‚‡ã†ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šæ‰‹å½¢ã®å½“äº‹è€…ã‚’æ•´ç†ï¼ˆæŒ¯å‡ºäººãƒ»åå®›äººãƒ»å—å–äººãƒ»æ”¯æ‰•äººï¼‰ã€‚${isReceivable ? "å£²æ›é‡‘â†’å—å–æ‰‹å½¢â†’ç¾é‡‘" : "è²·æ›é‡‘â†’æ”¯æ‰•æ‰‹å½¢â†’å½“åº§é é‡‘æ¸›å°‘"}ã®æµã‚Œã‚’æŠŠæ¡ã€‚æ‰‹å½¢è¨˜å…¥å¸³ã¨ã®é–¢é€£ã‚‚é‡è¦ã€‚`;
      }
      // å°åˆ‡æ‰‹é–¢é€£
      else if (questionText.includes("å°åˆ‡æ‰‹")) {
        const isDrawn = questionText.includes("æŒ¯å‡º");
        explanation = `å°åˆ‡æ‰‹${isDrawn ? "æŒ¯å‡º" : "å—å–"}ã«ã‚ˆã‚‹${isDrawn ? "æ”¯æ‰•" : "ä»£é‡‘å›å"}å‡¦ç†ã€‚å°åˆ‡æ‰‹ã¯é€šè²¨ä»£ç”¨è¨¼åˆ¸ã¨ã—ã¦å‡¦ç†ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼š${isDrawn ? "å°åˆ‡æ‰‹æŒ¯å‡ºã¯ã€Œå½“åº§é é‡‘ã€ã®æ¸›å°‘ï¼ˆè²¸æ–¹ï¼‰" : "ä»–åº—æŒ¯å‡ºå°åˆ‡æ‰‹å—å–ã¯ã€Œç¾é‡‘ã€ã®å¢—åŠ ï¼ˆå€Ÿæ–¹ï¼‰"}ã€‚å½“åº§å€Ÿè¶Šæ™‚ã¯ã€Œå½“åº§å€Ÿè¶Šã€å‹˜å®šã‚’ä½¿ç”¨ã€‚è‡ªå·±æŒ¯å‡ºå°åˆ‡æ‰‹ã®å—å–ã¯ç›¸æ®ºå‡¦ç†ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼š${isDrawn ? "å½“åº§é é‡‘æ®‹é«˜ä¸è¶³â†’å½“åº§å€Ÿè¶Šï¼ˆéŠ€è¡Œã‹ã‚‰ã®çŸ­æœŸå€Ÿå…¥ï¼‰" : "å°åˆ‡æ‰‹ï¼å³åº§ã«ç¾é‡‘åŒ–å¯èƒ½ãªè¨¼åˆ¸"}ã€‚æŒ¯å‡ºæ—¥ãƒ»å—å–æ—¥ã®é•ã„ã«ã‚ˆã‚‹å‡¦ç†ã®å¤‰åŒ–ã‚‚ç†è§£ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚`;
      }
      // å•†å“å£²è²·é–¢é€£
      else if (
        (questionText.includes("å£²ä¸Š") || questionText.includes("ä»•å…¥")) &&
        questionText.includes("å•†å“")
      ) {
        const isSales = questionText.includes("å£²ä¸Š");
        explanation = `å•†å“${isSales ? "å£²ä¸Š" : "ä»•å…¥"}ã®ä¸‰åˆ†æ³•å‡¦ç†ã€‚${isSales ? "åç›Š" : "è²»ç”¨"}ã®è¨ˆä¸Šã¨å‚µæ¨©ãƒ»å‚µå‹™ã®ç®¡ç†ã‚’è¡Œã„ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šä¸‰åˆ†æ³•ã§ã¯ã€Œ${isSales ? "å£²ä¸Š" : "ä»•å…¥"}ã€ã€Œç¹°è¶Šå•†å“ã€ã‚’ä½¿ç”¨ã€‚åˆ†è¨˜æ³•ãƒ»ç·è¨˜æ³•ã¨æ··åŒã—ãªã„ã€‚${isSales ? "å£²ä¸Šè¿”å“â†’ã€Œå£²ä¸Šã€æ¸›å°‘" : "ä»•å…¥è¿”å“â†’ã€Œä»•å…¥ã€æ¸›å°‘"}ã€‚é‹è³ƒè² æ‹…ã®å‡¦ç†ã‚‚è¦æ³¨æ„ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼š${isSales ? "æ›å£²ä¸Šãªã‚‰å£²æ›é‡‘ç™ºç”Ÿã€ç¾é‡‘å£²ä¸Šãªã‚‰ç¾é‡‘å¢—åŠ " : "æ›ä»•å…¥ãªã‚‰è²·æ›é‡‘ç™ºç”Ÿã€ç¾é‡‘ä»•å…¥ãªã‚‰ç¾é‡‘æ¸›å°‘"}ã€‚å¼•å–é‹è³ƒã¯${isSales ? "ç™ºé€è²»ï¼ˆè²©ç®¡è²»ï¼‰" : "ä»•å…¥åŸä¾¡ã«å«ã‚ã‚‹"}ã€‚æœŸæœ«å•†å“æ£šå¸ã§å£²ä¸ŠåŸä¾¡è¨ˆç®—ã€‚`;
      }
      // çµ¦æ–™ãƒ»çµ¦ä¸é–¢é€£
      else if (questionText.includes("çµ¦æ–™") || questionText.includes("çµ¦ä¸")) {
        explanation = `çµ¦æ–™æ”¯æ‰•ã„ã®å‡¦ç†ã€‚ç·æ”¯çµ¦é¡ã®è²»ç”¨è¨ˆä¸Šã¨æºæ³‰ç¨ç­‰ã®é ã‚Šé‡‘å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šã€Œçµ¦æ–™ã€ã¯ç·æ”¯çµ¦é¡ã§è²»ç”¨è¨ˆä¸Šã€‚æºæ³‰ç¨ãƒ»ä½æ°‘ç¨ãƒ»ç¤¾ä¼šä¿é™ºæ–™ã¯ã€Œé ã‚Šé‡‘ã€ï¼ˆè² å‚µï¼‰ã€‚æ‰‹å–é¡ã®ã¿ã‚’ã€Œçµ¦æ–™ã€ã«ã—ãªã„ã€‚æœªæ‰•çµ¦æ–™ã¨çµ¦æ–™ã®åŒºåˆ¥ã‚‚é‡è¦ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šçµ¦æ–™ï¼è²»ç”¨ã€é ã‚Šé‡‘ï¼è² å‚µã€ç¾é‡‘ï¼æ‰‹å–é¡ã®é–¢ä¿‚ã‚’ç†è§£ã€‚é ã‚Šé‡‘ã¯å¾Œæ—¥ç¨å‹™ç½²ãƒ»è‡ªæ²»ä½“ã«ç´ä»˜ã€‚è³ä¸ãƒ»é€€è·é‡‘ã‚‚åŒæ§˜ã®å‡¦ç†ã€‚åŠ´åƒä¿é™ºæ–™ã®ä¼šç¤¾è² æ‹…åˆ†ã¯åˆ¥é€”ã€Œç¦åˆ©åšç”Ÿè²»ã€ã§è¨ˆä¸Šã€‚`;
      }
      // æ¸›ä¾¡å„Ÿå´é–¢é€£
      else if (questionText.includes("æ¸›ä¾¡å„Ÿå´")) {
        explanation = `å›ºå®šè³‡ç”£ã®æ¸›ä¾¡å„Ÿå´å‡¦ç†ã€‚ä½¿ç”¨æœŸé–“ã«å¿œã˜ãŸä¾¡å€¤æ¸›å°‘ã‚’è²»ç”¨ã¨ã—ã¦è¨ˆä¸Šã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šé–“æ¥æ³•ã§ã¯ã€Œæ¸›ä¾¡å„Ÿå´ç´¯è¨ˆé¡ã€ï¼ˆè³‡ç”£ã®ãƒã‚¤ãƒŠã‚¹å‹˜å®šï¼‰ã‚’ä½¿ç”¨ã€‚ç›´æ¥æ³•ã¨æ··åŒã—ãªã„ã€‚å®šé¡æ³•ãƒ»å®šç‡æ³•ã®è¨ˆç®—å¼ã‚‚è¦ç¢ºèªã€‚æœˆå‰²è¨ˆç®—æ™‚ã®ç«¯æ•°å‡¦ç†ã«æ³¨æ„ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šå¸³ç°¿ä¾¡é¡ï¼å–å¾—åŸä¾¡ï¼æ¸›ä¾¡å„Ÿå´ç´¯è¨ˆé¡ã€‚è²¸å€Ÿå¯¾ç…§è¡¨ã§ã¯ç´¯è¨ˆé¡ã‚’æ§é™¤è¡¨ç¤ºã€‚è€ç”¨å¹´æ•°ãƒ»æ®‹å­˜ä¾¡é¡ãƒ»å„Ÿå´ç‡ã®é–¢ä¿‚ã‚’ç†è§£ã€‚æœŸä¸­å–å¾—æ™‚ã¯æœˆå‰²è¨ˆç®—ãŒåŸºæœ¬ã€‚`;
      }
      // è²¸å€’é–¢é€£
      else if (questionText.includes("è²¸å€’")) {
        explanation = `è²¸å€’å‡¦ç†ã€‚å‚µæ¨©ã®å›åä¸èƒ½ã«å¯¾ã™ã‚‹æå¤±è¨ˆä¸Šã¾ãŸã¯å¼•å½“é‡‘ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šç›´æ¥å„Ÿå´æ³•ã¨å¼•å½“é‡‘æ³•ã®é•ã„ã‚’ç†è§£ã€‚ã€Œè²¸å€’å¼•å½“é‡‘ã€ã¯è³‡ç”£ã®ãƒã‚¤ãƒŠã‚¹å‹˜å®šï¼ˆè²¸å€Ÿå¯¾ç…§è¡¨ã®è²¸æ–¹è¡¨ç¤ºã ãŒè³‡ç”£ã®æ¸›å°‘ï¼‰ã€‚ç¹°å…¥ã¨å–å´©ã®å‡¦ç†ã‚’æ··åŒã—ãªã„ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šå¼•å½“é‡‘æ³•ã§ã¯å°†æ¥ã®è²¸å€’ã‚Œã«å‚™ãˆã¦äº‹å‰è¨­å®šã€‚å®Ÿéš›ã®è²¸å€’ã‚Œæ™‚ã¯å¼•å½“é‡‘ã‹ã‚‰å……å½“ã€‚ä¸è¶³åˆ†ã¯ã€Œè²¸å€’æå¤±ã€ã§å‡¦ç†ã€‚å‚µæ¨©åˆ¥ï¼ˆå£²æ›é‡‘ãƒ»å—å–æ‰‹å½¢ç­‰ï¼‰ã®å¼•å½“é‡‘è¨­å®šç‡ã‚‚è¦šãˆã¦ãŠãã¾ã—ã‚‡ã†ã€‚`;
      }
      // ä¿é™ºæ–™é–¢é€£
      else if (questionText.includes("ä¿é™ºæ–™")) {
        explanation = `ä¿é™ºæ–™æ”¯æ‰•ã„ã®å‡¦ç†ã€‚æœŸé–“ã«å¿œã˜ãŸè²»ç”¨é…åˆ†ã¨çµŒéå‹˜å®šã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šã€Œä¿é™ºæ–™ã€ï¼ˆè²»ç”¨ï¼‰ã¨ã€Œå‰æ‰•ä¿é™ºæ–™ã€ï¼ˆè³‡ç”£ï¼‰ã®åŒºåˆ¥ã€‚æ±ºç®—æ™‚ã®æœªçµŒéåˆ†ã¯å‰æ‰•å‡¦ç†ã€‚ä¿é™ºæœŸé–“ã¨ä¼šè¨ˆæœŸé–“ã®ã‚ºãƒ¬ã«æ³¨æ„ã€‚ã€Œæ”¯æ‰•ä¿é™ºæ–™ã€ã¨è¡¨è¨˜ã•ã‚Œã‚‹ã“ã¨ã‚‚ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šä¿é™ºæ–™ã®æœŸé–“æŒ‰åˆ†è¨ˆç®—ã‚’ãƒã‚¹ã‚¿ãƒ¼ã€‚æœˆæ•°è¨ˆç®—ã¯æ­£ç¢ºã«ï¼ˆä¾‹ï¼š4æœˆ1æ—¥ï½ç¿Œå¹´3æœˆ31æ—¥ï¼12ãƒ¶æœˆï¼‰ã€‚ç«ç½ä¿é™ºãƒ»è‡ªå‹•è»Šä¿é™ºç­‰ã€ä¿é™ºã®ç¨®é¡ã«ã‚ˆã‚Šå‹˜å®šç§‘ç›®åãŒç•°ãªã‚‹å ´åˆã‚‚ã€‚`;
      }
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè§£èª¬
      else {
        const idNumber = parseInt(questionId.replace("Q_J_", ""));
        if (amounts.length > 0) {
          explanation = `${amounts[0]}ã®å–å¼•ã«é–¢ã™ã‚‹ä»•è¨³å‡¦ç†ã€‚å–å¼•ã®çµŒæ¸ˆçš„å®Ÿè³ªã‚’ç†è§£ã—é©åˆ‡ãªå‹˜å®šç§‘ç›®ã§å‡¦ç†ã—ã¾ã™ã€‚`;
        } else {
          explanation = `åŸºæœ¬çš„ãªä»•è¨³å•é¡Œï¼ˆå•é¡Œ${idNumber}ï¼‰ã€‚å–å¼•å†…å®¹ã‚’æ­£ç¢ºã«èª­ã¿å–ã‚Šé©åˆ‡ã«å‡¦ç†ã—ã¦ãã ã•ã„ã€‚`;
        }

        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šå‹˜å®šç§‘ç›®åã®é¸æŠãƒŸã‚¹ï¼ˆé¡ä¼¼ç§‘ç›®ã«æ³¨æ„ï¼‰ã€å€Ÿæ–¹ãƒ»è²¸æ–¹ã®åˆ¤å®šãƒŸã‚¹ã€é‡‘é¡ã®è»¢è¨˜ãƒŸã‚¹ã€‚å•é¡Œæ–‡ã®ã€Œã€œã¨ã—ãŸã€ã€Œã€œã‚’è¡Œã£ãŸã€ç­‰ã®è¡¨ç¾ã‹ã‚‰ä½•ã®ä»•è¨³ã‹ã‚’æ­£ç¢ºã«èª­ã¿å–ã‚‹ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼š5ã¤ã®å‹˜å®šç§‘ç›®åˆ†é¡ï¼ˆè³‡ç”£ãƒ»è² å‚µãƒ»ç´”è³‡ç”£ãƒ»åç›Šãƒ»è²»ç”¨ï¼‰ã¨å€Ÿæ–¹ãƒ»è²¸æ–¹ã®ãƒ«ãƒ¼ãƒ«ã‚’å®Œå…¨ç¿’å¾—ã€‚ä»•è¨³ã¯ã€ŒåŸå› â†’çµæœã€ã§è€ƒãˆã‚‹ã€‚åå¾©ç·´ç¿’ã§ä»•è¨³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½“ã«è¦šãˆè¾¼ã¾ã›ã¾ã—ã‚‡ã†ã€‚`;
      }

      return explanation + "\\n\\n" + mistakePoints + "\\n\\n" + learningTips;
    }

    // ç¬¬2å•ï¼ˆå¸³ç°¿å•é¡Œï¼‰ã®è©³ç´°å­¦ç¿’è§£èª¬
    else if (questionId.startsWith("Q_L_")) {
      let explanation = "";
      let mistakePoints = "";
      let learningTips = "";

      if (questionText.includes("ç·å‹˜å®šå…ƒå¸³")) {
        explanation = `ç·å‹˜å®šå…ƒå¸³ã¸ã®è»¢è¨˜å‡¦ç†ã€‚ä»•è¨³å¸³ã‹ã‚‰å‹˜å®šç§‘ç›®åˆ¥ã«åˆ†é¡è»¢è¨˜ã—ã€å„å‹˜å®šã®æ®‹é«˜ã‚’ç®¡ç†ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šè»¢è¨˜ã®å€Ÿæ–¹ãƒ»è²¸æ–¹ã‚’é–“é•ãˆã‚‹ã€æ‘˜è¦æ¬„ã«ç›¸æ‰‹å‹˜å®šç§‘ç›®ã‚’è¨˜è¼‰ã—å¿˜ã‚Œã€æ—¥ä»˜ã®è»¢è¨˜ãƒŸã‚¹ã€æ®‹é«˜ã®è¨ˆç®—é–“é•ã„ã€‚ã€Œå…ƒä¸ã€æ¬„ã®è¨˜è¼‰ã‚‚å¿˜ã‚Œãšã«ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šã€Œä»•è¨³â†’è»¢è¨˜â†’æ®‹é«˜è¨ˆç®—ã€ã®æµã‚Œã‚’ç¢ºå®Ÿã«ã€‚å‹˜å®šå£åº§ã®å·¦å´ï¼å€Ÿæ–¹ã€å³å´ï¼è²¸æ–¹ã€‚æ®‹é«˜ã¯å€Ÿæ–¹ãƒ»è²¸æ–¹ã®ã©ã¡ã‚‰ã«æ®‹ã‚‹ã‹ï¼ˆå‹˜å®šã®æ€§è³ªï¼‰ã‚’ç†è§£ã—ã¦è¨ˆç®—ã€‚`;
      } else if (questionText.includes("ç¾é‡‘å‡ºç´å¸³")) {
        explanation = `ç¾é‡‘å‡ºç´å¸³ã¸ã®è¨˜å…¥å‡¦ç†ã€‚ç¾é‡‘ã®åå…¥ãƒ»æ”¯å‡ºã‚’æ™‚ç³»åˆ—ã§è¨˜éŒ²ã—ã€ç¾é‡‘æ®‹é«˜ã‚’ç®¡ç†ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šåå…¥ï¼ˆå€Ÿæ–¹å–å¼•ï¼‰ã¨æ”¯å‡ºï¼ˆè²¸æ–¹å–å¼•ï¼‰ã®åŒºåˆ¥ã€æ®‹é«˜ã®ç´¯è¨ˆè¨ˆç®—ãƒŸã‚¹ã€æ‘˜è¦ã®è¨˜è¼‰ä¸å‚™ã€‚ç¾é‡‘ä»¥å¤–ã®å–å¼•ï¼ˆæŒ¯æ›¿ç­‰ï¼‰ã¯è¨˜å…¥ã—ãªã„ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šç¾é‡‘å‡ºç´å¸³ã¯ç¾é‡‘å‹˜å®šã®è£œåŠ©ç°¿ã€‚åå…¥ï¼ç¾é‡‘ã®å¢—åŠ ã€æ”¯å‡ºï¼ç¾é‡‘ã®æ¸›å°‘ã¨è€ƒãˆã‚‹ã€‚æ®‹é«˜ã¯å‰æ—¥æ®‹é«˜Â±å½“æ—¥å¢—æ¸›ã€‚ç¾é‡‘å®ŸæŸ»ã¨ã®ç…§åˆã§å·®ç•°ãƒã‚§ãƒƒã‚¯ã€‚`;
      } else if (questionText.includes("å£²ä¸Šå¸³")) {
        explanation = `å£²ä¸Šå¸³ã¸ã®è¨˜å…¥å‡¦ç†ã€‚å¾—æ„å…ˆåˆ¥ã®æ›å£²ä¸Šã‚’è¨˜éŒ²ã—ã€å£²æ›é‡‘ã®è©³ç´°ã‚’ç®¡ç†ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šç¾é‡‘å£²ä¸Šã¯è¨˜å…¥ã—ãªã„ï¼ˆæ›å£²ä¸Šã®ã¿ï¼‰ã€è¿”å“ãƒ»å€¤å¼•ãã®â–³è¡¨ç¤ºã‚’å¿˜ã‚Œã‚‹ã€å¾—æ„å…ˆåã®è¨˜è¼‰ãƒŸã‚¹ã€åˆè¨ˆé‡‘é¡ã®è¨ˆç®—é–“é•ã„ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šå£²ä¸Šå¸³ã¯å£²æ›é‡‘å…ƒå¸³ã®åŸºç¤è³‡æ–™ã€‚å£²ä¸Šï¼åç›Šã€å£²æ›é‡‘ï¼è³‡ç”£ã®é–¢ä¿‚ã‚’ç†è§£ã€‚è¿”å“ãƒ»å€¤å¼•ãã§å£²ä¸Šãƒ»å£²æ›é‡‘ãŒæ¸›å°‘ã€‚å¾—æ„å…ˆåˆ¥æ®‹é«˜ç®¡ç†ã«æ´»ç”¨ã€‚`;
      } else if (questionText.includes("ä»•å…¥å¸³")) {
        explanation = `ä»•å…¥å¸³ã¸ã®è¨˜å…¥å‡¦ç†ã€‚ä»•å…¥å…ˆåˆ¥ã®æ›ä»•å…¥ã‚’è¨˜éŒ²ã—ã€è²·æ›é‡‘ã®è©³ç´°ã‚’ç®¡ç†ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šç¾é‡‘ä»•å…¥ã¯è¨˜å…¥ã—ãªã„ï¼ˆæ›ä»•å…¥ã®ã¿ï¼‰ã€è¿”å“ãƒ»å€¤å¼•ãã®â–³è¡¨ç¤ºã‚’å¿˜ã‚Œã‚‹ã€ä»•å…¥å…ˆåã®è¨˜è¼‰ãƒŸã‚¹ã€å¼•å–é‹è³ƒç­‰ã®ä»˜å¸¯è²»ç”¨ã®å‡¦ç†ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šä»•å…¥å¸³ã¯è²·æ›é‡‘å…ƒå¸³ã®åŸºç¤è³‡æ–™ã€‚ä»•å…¥ï¼è²»ç”¨ã€è²·æ›é‡‘ï¼è² å‚µã®é–¢ä¿‚ã‚’ç†è§£ã€‚å¼•å–é‹è³ƒã¯ä»•å…¥åŸä¾¡ã«å«ã‚ã‚‹ã€‚ä»•å…¥å…ˆåˆ¥æ®‹é«˜ç®¡ç†ã«æ´»ç”¨ã€‚`;
      } else if (questionText.includes("å•†å“æœ‰é«˜å¸³")) {
        explanation = `å•†å“æœ‰é«˜å¸³ã¸ã®è¨˜å…¥å‡¦ç†ã€‚å•†å“ã®å—å…¥ãƒ»æ‰•å‡ºãƒ»æ®‹é«˜ã‚’ç¶™ç¶šè¨˜éŒ²ã—ã€åœ¨åº«ã‚’ç®¡ç†ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šå…ˆå…¥å…ˆå‡ºæ³•ã¨ç§»å‹•å¹³å‡æ³•ã®è¨ˆç®—é•ã„ã€æ‰•å‡ºå˜ä¾¡ã®ç®—å®šãƒŸã‚¹ã€æ•°é‡ã¨é‡‘é¡ã®ä¸ä¸€è‡´ã€æœŸæœ«å•†å“æ£šå¸é«˜ã¨ã®ç…§åˆä¸å‚™ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šè©•ä¾¡æ–¹æ³•ï¼ˆå…ˆå…¥å…ˆå‡ºæ³•ãƒ»ç§»å‹•å¹³å‡æ³•ï¼‰ã‚’æ­£ç¢ºã«é©ç”¨ã€‚å—å…¥ï¼ä»•å…¥æ™‚ã€æ‰•å‡ºï¼å£²ä¸Šæ™‚ã€‚å¸¸ã«ã€Œæ•°é‡Ã—å˜ä¾¡ï¼é‡‘é¡ã€ã‚’ãƒã‚§ãƒƒã‚¯ã€‚æ£šå¸è³‡ç”£ç®¡ç†ã®é‡è¦ãªå¸³ç°¿ã€‚`;
      } else if (questionText.includes("å—å–æ‰‹å½¢è¨˜å…¥å¸³")) {
        explanation = `å—å–æ‰‹å½¢è¨˜å…¥å¸³ã¸ã®è¨˜å…¥å‡¦ç†ã€‚ç´„æŸæ‰‹å½¢ã®å—å–ã‹ã‚‰æ±ºæ¸ˆã¾ã§ç®¡ç†ã—ã€æ‰‹å½¢ã®æµã‚Œã‚’è¿½è·¡ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šæŒ¯å‡ºäººã¨æ”¯æ‰•äººã®æ··åŒã€æº€æœŸæ—¥ã®è¨ˆç®—ãƒŸã‚¹ã€æ±ºæ¸ˆãƒ»ä¸æ¸¡ã‚Šã®è¨˜è¼‰æ¼ã‚Œã€è£æ›¸ãƒ»å‰²å¼•æ™‚ã®å‡¦ç†ä¸å‚™ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šæ‰‹å½¢ã®å½“äº‹è€…é–¢ä¿‚ã‚’æ•´ç†ï¼ˆæŒ¯å‡ºäººâ†’å—å–äººã€æ”¯æ‰•äººâ†’æ”¯æ‰•éŠ€è¡Œï¼‰ã€‚æº€æœŸæ—¥è¨ˆç®—ã¯æ­£ç¢ºã«ï¼ˆæ”¯æ‰•æœŸæ—¥ï¼‰ã€‚æ±ºæ¸ˆæ™‚ã«æ‰‹å½¢ã‹ã‚‰ç¾é‡‘ã¸å¤‰æ›ã€‚`;
      } else if (questionText.includes("æ”¯æ‰•æ‰‹å½¢è¨˜å…¥å¸³")) {
        explanation = `æ”¯æ‰•æ‰‹å½¢è¨˜å…¥å¸³ã¸ã®è¨˜å…¥å‡¦ç†ã€‚ç´„æŸæ‰‹å½¢ã®æŒ¯å‡ºã‹ã‚‰æ±ºæ¸ˆã¾ã§ç®¡ç†ã—ã€æ”¯æ‰•ç¾©å‹™ã‚’è¿½è·¡ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šå—å–äººã¨æ”¯æ‰•éŠ€è¡Œã®è¨˜è¼‰ãƒŸã‚¹ã€æº€æœŸæ—¥ã®ç®¡ç†ä¸å‚™ã€å½“åº§é é‡‘æ®‹é«˜ã¨ã®é–¢é€£æŠŠæ¡ä¸è¶³ã€ä¸æ¸¡ã‚Šæ™‚ã®å‡¦ç†ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šæ”¯æ‰•æ‰‹å½¢ï¼å°†æ¥ã®æ”¯æ‰•ç¾©å‹™ã€‚æº€æœŸæ—¥ã«å½“åº§é é‡‘ã‹ã‚‰è‡ªå‹•å¼•è½ã—ã€‚è³‡é‡‘ç¹°ã‚Šè¨ˆç”»ã¨ã®é€£å‹•ãŒé‡è¦ã€‚æ‰‹å½¢ä¸æ¸¡ã‚Šã¯ä¿¡ç”¨å•é¡Œã«ç›´çµã€‚`;
      } else {
        explanation = `å¸³ç°¿è¨˜å…¥å•é¡Œï¼ˆ${questionId}ï¼‰ã€‚å„ç¨®å¸³ç°¿ã®ç‰¹æ€§ã¨è¨˜å…¥ãƒ«ãƒ¼ãƒ«ã‚’ç†è§£ã—ã€é©åˆ‡ã«å‡¦ç†ã—ã¦ãã ã•ã„ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šä¸»è¦ç°¿ã¨è£œåŠ©ç°¿ã®åŒºåˆ¥ã€å„å¸³ç°¿ã®è¨˜å…¥ãƒ«ãƒ¼ãƒ«é•ã„ã€è»¢è¨˜ãƒ»è¨˜å…¥ã®æ–¹å‘æ€§ãƒŸã‚¹ã€æ®‹é«˜è¨ˆç®—ã®èª¤ã‚Šã€‚å¸³ç°¿é–“ã®æ•´åˆæ€§ç¢ºä¿ã‚‚é‡è¦ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šä»•è¨³å¸³â†’ç·å‹˜å®šå…ƒå¸³ã¸ã®è»¢è¨˜ã®æµã‚Œã‚’ç†è§£ã€‚è£œåŠ©ç°¿ã¯è©³ç´°ç®¡ç†ç”¨ã€‚å„å¸³ç°¿ã®ç›®çš„ãƒ»æ©Ÿèƒ½ã‚’æŠŠæ¡ã—ã€å®Ÿå‹™ã§ã®æ´»ç”¨æ³•ã‚‚å­¦ç¿’ã—ã¾ã—ã‚‡ã†ã€‚`;
      }

      return explanation + "\\n\\n" + mistakePoints + "\\n\\n" + learningTips;
    }

    // ç¬¬3å•ï¼ˆè¡¨ä½œæˆå•é¡Œï¼‰ã®è©³ç´°å­¦ç¿’è§£èª¬
    else if (questionId.startsWith("Q_T_")) {
      let explanation = "";
      let mistakePoints = "";
      let learningTips = "";

      if (questionText.includes("åˆè¨ˆè©¦ç®—è¡¨")) {
        explanation = `åˆè¨ˆè©¦ç®—è¡¨ã®ä½œæˆã€‚å„å‹˜å®šç§‘ç›®ã®æœŸä¸­å€Ÿæ–¹åˆè¨ˆãƒ»è²¸æ–¹åˆè¨ˆã‚’é›†è¨ˆã—ã€ä»•è¨³ã®æ­£ç¢ºæ€§ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šå€Ÿæ–¹åˆè¨ˆã¨è²¸æ–¹åˆè¨ˆã®ä¸ä¸€è‡´ã€å‹˜å®šç§‘ç›®ã®åˆ†é¡ãƒŸã‚¹ã€é›†è¨ˆã®è¨ˆç®—é–“é•ã„ã€æœŸä¸­å–å¼•ã®è¨ˆä¸Šæ¼ã‚Œã€‚è©¦ç®—è¡¨ã®è²¸å€Ÿå¹³å‡ãŒæˆç«‹ã—ãªã„å ´åˆã¯è¨ˆç®—è¦‹ç›´ã—ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šåˆè¨ˆè©¦ç®—è¡¨ã¯ã€Œä»•è¨³ã®æ¤œè¨¼ã€ãŒç›®çš„ã€‚å…¨å‹˜å®šã®å€Ÿæ–¹åˆè¨ˆï¼å…¨å‹˜å®šã®è²¸æ–¹åˆè¨ˆãŒæˆç«‹ã€‚å„å‹˜å®šã®åˆè¨ˆé¡ã‹ã‚‰å–å¼•ã®å¦¥å½“æ€§ã‚’ãƒã‚§ãƒƒã‚¯å¯èƒ½ã€‚`;
      } else if (questionText.includes("æ®‹é«˜è©¦ç®—è¡¨")) {
        explanation = `æ®‹é«˜è©¦ç®—è¡¨ã®ä½œæˆã€‚å„å‹˜å®šç§‘ç›®ã®æœŸæœ«æ®‹é«˜ã‚’ç®—å®šã—ã€å€Ÿæ–¹ãƒ»è²¸æ–¹ã«åˆ†é¡ã—ã¦è¡¨ç¤ºã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šæ®‹é«˜ã®å€Ÿæ–¹ãƒ»è²¸æ–¹åˆ¤å®šãƒŸã‚¹ã€å‹˜å®šã®æ€§è³ªï¼ˆè³‡ç”£ãƒ»è² å‚µç­‰ï¼‰ã®ç†è§£ä¸è¶³ã€è¨ˆç®—é–“é•ã„ã€è²¸å€Ÿåˆè¨ˆé¡ã®ä¸ä¸€è‡´ã€‚ã‚¼ãƒ­æ®‹é«˜å‹˜å®šã®å–æ‰±ã„ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šè³‡ç”£ãƒ»è²»ç”¨ã¯å€Ÿæ–¹æ®‹é«˜ã€è² å‚µãƒ»ç´”è³‡ç”£ãƒ»åç›Šã¯è²¸æ–¹æ®‹é«˜ãŒåŸå‰‡ã€‚æ®‹é«˜ï¼æœŸé¦–æ®‹é«˜ï¼‹å½“æœŸå¢—åŠ ï¼å½“æœŸæ¸›å°‘ã€‚è²¸å€Ÿå¯¾ç…§è¡¨ä½œæˆã®åŸºç¤è³‡æ–™ã¨ã—ã¦æ´»ç”¨ã€‚`;
      } else if (questionText.includes("ç²¾ç®—è¡¨")) {
        explanation = `ç²¾ç®—è¡¨ã®ä½œæˆã€‚è©¦ç®—è¡¨ã«æ±ºç®—æ•´ç†ã‚’åŠ ãˆã¦ä¿®æ­£ã—ã€æç›Šè¨ˆç®—æ›¸ãƒ»è²¸å€Ÿå¯¾ç…§è¡¨ã®åŸºç¤ã‚’ä½œæˆã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šä¿®æ­£è¨˜å…¥æ¬„ã®å€Ÿæ–¹ãƒ»è²¸æ–¹é–“é•ã„ã€æç›Šãƒ»è²¸å€Ÿã¸ã®æŒ¯åˆ†ã‘ãƒŸã‚¹ã€æ±ºç®—æ•´ç†ä»•è¨³ã®ç†è§£ä¸è¶³ã€å‹˜å®šç§‘ç›®åã®å¤‰æ›´ï¼ˆæœªæ‰•â—‹â—‹â†’æœªæ‰•è²»ç”¨ç­‰ï¼‰å¿˜ã‚Œã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šæ±ºç®—æ•´ç†ä»•è¨³ã‚’å®Œç’§ã«ãƒã‚¹ã‚¿ãƒ¼ã€‚ç²¾ç®—è¡¨ã¯æ±ºç®—æ›¸ä½œæˆã®ä¸‹æ›¸ãã€‚ä¿®æ­£è¨˜å…¥â†’æç›Šãƒ»è²¸å€Ÿã¸ã®åˆ†é¡â†’åˆè¨ˆã®æµã‚Œã‚’ç¢ºå®Ÿã«ã€‚ç¹°è¶Šå•†å“ãƒ»æ¸›ä¾¡å„Ÿå´ç­‰ã®å…¸å‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¿’å¾—ã€‚`;
      } else if (questionText.includes("æç›Šè¨ˆç®—æ›¸")) {
        explanation = `æç›Šè¨ˆç®—æ›¸ã®ä½œæˆã€‚åç›Šãƒ»è²»ç”¨ã‚’é©åˆ‡ã«åˆ†é¡ã—ã€æ®µéšåˆ©ç›Šï¼ˆå£²ä¸Šç·åˆ©ç›Šãƒ»å–¶æ¥­åˆ©ç›Šç­‰ï¼‰ã‚’ç®—å‡ºã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šåç›Šãƒ»è²»ç”¨ã®åˆ†é¡ãƒŸã‚¹ã€å£²ä¸ŠåŸä¾¡ã®ç®—å®šé–“é•ã„ã€å–¶æ¥­å¤–æç›Šã®åŒºåˆ†ä¸å‚™ã€ç‰¹åˆ¥æç›Šã®åˆ¤å®šãƒŸã‚¹ã€‚å½“æœŸç´”åˆ©ç›Šã®è¨ˆç®—ç¢ºèªã¯å¿…é ˆã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šã€Œå£²ä¸Šé«˜ï¼å£²ä¸ŠåŸä¾¡ï¼å£²ä¸Šç·åˆ©ç›Šã€ã€Œå£²ä¸Šç·åˆ©ç›Šï¼è²©ç®¡è²»ï¼å–¶æ¥­åˆ©ç›Šã€ç­‰ã®æ®µéšåˆ©ç›Šè¨ˆç®—ã‚’ãƒã‚¹ã‚¿ãƒ¼ã€‚æ±ºç®—æ•´ç†ã«ã‚ˆã‚‹å½±éŸ¿ï¼ˆæ¸›ä¾¡å„Ÿå´è²»ãƒ»è²¸å€’å¼•å½“é‡‘ç­‰ï¼‰ã‚‚ç†è§£ã€‚`;
      } else if (questionText.includes("è²¸å€Ÿå¯¾ç…§è¡¨")) {
        explanation = `è²¸å€Ÿå¯¾ç…§è¡¨ã®ä½œæˆã€‚è³‡ç”£ãƒ»è² å‚µãƒ»ç´”è³‡ç”£ã‚’æµå‹•ãƒ»å›ºå®šã«åˆ†é¡ã—ã€è²¡æ”¿çŠ¶æ…‹ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šæµå‹•ãƒ»å›ºå®šã®åˆ†é¡åŸºæº–ï¼ˆ1å¹´åŸºæº–ï¼‰ã®é©ç”¨ãƒŸã‚¹ã€è²¸å€’å¼•å½“é‡‘ç­‰ã®æ§é™¤é …ç›®è¡¨ç¤ºã€ç´”è³‡ç”£ã®éƒ¨ã®è¨ˆç®—é–“é•ã„ã€è³‡ç”£åˆè¨ˆâ‰ è² å‚µãƒ»ç´”è³‡ç”£åˆè¨ˆã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šã€Œè³‡ç”£ï¼è² å‚µï¼‹ç´”è³‡ç”£ã€ã®åŸºæœ¬ç­‰å¼ã‚’ç¢ºèªã€‚æµå‹•æ€§é…åˆ—ï¼ˆè³‡ç”£ã®æ›é‡‘æ€§é †ï¼‰ãƒ»å›ºå®šæ€§é…åˆ—ï¼ˆè² å‚µã®æ”¯æ‰•æœŸé™é †ï¼‰ã§é…åˆ—ã€‚å½“æœŸç´”åˆ©ç›Šã¯ç´”è³‡ç”£ã‚’å¢—åŠ ã•ã›ã‚‹ã€‚`;
      } else {
        explanation = `è¡¨ä½œæˆå•é¡Œï¼ˆ${questionId}ï¼‰ã€‚å„ç¨®è²¡å‹™è«¸è¡¨ãƒ»è©¦ç®—è¡¨ã®ä½œæˆåŸç†ã‚’ç†è§£ã—ã€æ­£ç¢ºã«ä½œæˆã—ã¦ãã ã•ã„ã€‚`;
        mistakePoints = `âš ï¸ é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆï¼šå„è¡¨ã®ä½œæˆç›®çš„ã®ç†è§£ä¸è¶³ã€è¨ˆç®—ãƒŸã‚¹ã€åˆ†é¡ãƒŸã‚¹ã€è²¸å€Ÿä¸ä¸€è‡´ã€‚æ±ºç®—æ•´ç†äº‹é …ã®åæ˜ æ¼ã‚Œã€å‹˜å®šç§‘ç›®ã®è¡¨ç¤ºæ–¹æ³•é–“é•ã„ã€‚`;
        learningTips = `ğŸ’¡ å­¦ç¿’ã®ã‚³ãƒ„ï¼šæ±ºç®—æ•´ç†ä»•è¨³â†’ç²¾ç®—è¡¨â†’è²¡å‹™è«¸è¡¨ã®æµã‚Œã‚’å®Œå…¨ç†è§£ã€‚å„è¡¨ã®ç›¸äº’é–¢ä¿‚ï¼ˆç²¾ç®—è¡¨ã®æç›Šè¨ˆç®—æ›¸æ¬„â†’æç›Šè¨ˆç®—æ›¸ã€è²¸å€Ÿå¯¾ç…§è¡¨æ¬„â†’è²¸å€Ÿå¯¾ç…§è¡¨ï¼‰ã‚’æŠŠæ¡ã€‚åå¾©ç·´ç¿’ã§è¨ˆç®—ã‚¹ãƒ”ãƒ¼ãƒ‰å‘ä¸Šã€‚`;
      }

      return explanation + "\\n\\n" + mistakePoints + "\\n\\n" + learningTips;
    }

    return "å•é¡Œå›ºæœ‰ã®å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆã‚’ç†è§£ã—ã€ç°¿è¨˜ã®åŸºæœ¬åŸç†ã«å¾“ã£ã¦å‡¦ç†ã—ã¦ãã ã•ã„ã€‚";
  } catch (error) {
    return `å•é¡Œ${questionId}ã®å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆã€‚å–å¼•å†…å®¹ã‚’ç†è§£ã—ã€é©åˆ‡ãªå‡¦ç†ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚é–“é•ãˆã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆã¨å­¦ç¿’ã®ã‚³ãƒ„ã‚’æ„è­˜ã—ã¦å–ã‚Šçµ„ã¿ã¾ã—ã‚‡ã†ã€‚`;
  }
}

// å…¨å•é¡Œã®è§£èª¬ã‚’è©³ç´°å­¦ç¿’ç‰ˆã«æ›´æ–°
let updatedCount = 0;
const updatedQuestions = [];

questions.forEach((question) => {
  const newExplanation = generateDetailedLearningExplanation(question);

  if (newExplanation !== question.explanation) {
    const oldExplanation = question.explanation;
    question.explanation = newExplanation;
    updatedCount++;

    updatedQuestions.push({
      id: question.id,
      questionText: question.question_text.substring(0, 50) + "...",
      oldExplanation: oldExplanation.substring(0, 60) + "...",
      newExplanation: newExplanation.substring(0, 100) + "...",
    });
  }
});

// TypeScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†æ§‹ç¯‰
const beforeData = content.substring(0, startIndex);
const afterData = content.substring(endIndex);

// å…ƒã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æˆ»ã™
const formattedQuestions = questions
  .map((q) => {
    // explanationãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
    const escapedExplanation = q.explanation
      .replace(/\\/g, "\\\\")
      .replace(/"/g, '\\"')
      .replace(/\n/g, "\\n");

    return `  {
    id: "${q.id}",
    category_id: "${q.category_id}",
    difficulty: ${q.difficulty},
    question_text: "${q.question_text.replace(/"/g, '\\"').replace(/\n/g, "\\n")}",
    answer_template_json: "${q.answer_template_json.replace(/"/g, '\\"')}",
    correct_answer_json: "${q.correct_answer_json.replace(/"/g, '\\"')}",
    explanation: "${escapedExplanation}",
    tags_json: "${q.tags_json.replace(/"/g, '\\"')}",
    created_at: "${q.created_at}",
    updated_at: "${q.updated_at}"
  }`;
  })
  .join(",\\n");

const newContent =
  beforeData + "[\\n" + formattedQuestions + "\\n]" + afterData;
fs.writeFileSync(tsFilePath, newContent, "utf8");

console.log(`âœ… ${updatedCount}å•ã®è§£èª¬ã‚’è©³ç´°å­¦ç¿’ç‰ˆã«æ›´æ–°ã—ã¾ã—ãŸï¼\\n`);

// æ›´æ–°ã•ã‚ŒãŸè§£èª¬ã®ä¾‹ã‚’è¡¨ç¤º
console.log("ğŸ¯ è©³ç´°å­¦ç¿’è§£èª¬ã®ä¾‹:\\n");

updatedQuestions.slice(0, 5).forEach((item, index) => {
  console.log(`${index + 1}. ${item.id}:`);
  console.log(`   å•é¡Œ: ${item.questionText}`);
  console.log(`   æ—§è§£èª¬: ${item.oldExplanation}`);
  console.log(`   æ–°è§£èª¬: ${item.newExplanation}`);
  console.log("");
});

if (updatedQuestions.length > 5) {
  console.log(
    `   ... ä»– ${updatedQuestions.length - 5}å•ã‚‚è©³ç´°å­¦ç¿’ç‰ˆã«æ›´æ–°\\n`,
  );
}

console.log("âœ¨ è©³ç´°å­¦ç¿’è§£èª¬ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼");
console.log("ğŸ“š æ”¹å–„å†…å®¹:");
console.log("  - é–“é•ãˆã‚„ã™ã„å‹˜å®šç§‘ç›®ãƒ»ãƒã‚¤ãƒ³ãƒˆã‚’æ˜è¨˜");
console.log("  - ç†è§£ã®ãŸã‚ã®å…·ä½“çš„ãªå­¦ç¿’ã®ã‚³ãƒ„ã‚’æä¾›");
console.log("  - ç°¿è¨˜3ç´šå—é¨“ç”Ÿå‘ã‘ã®å®Ÿç”¨çš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹");
console.log("  - å•é¡Œå›ºæœ‰ã®æ³¨æ„ç‚¹ã¨ã‚ˆãã‚ã‚‹ãƒŸã‚¹ã‚’è§£èª¬");
