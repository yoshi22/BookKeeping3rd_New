const fs = require("fs");
const path = require("path");

console.log("🔧 パターン1：勘定記入問題の修正\n");

const questionsPath = path.join(
  __dirname,
  "..",
  "src",
  "data",
  "master-questions.ts",
);
let content = fs.readFileSync(questionsPath, "utf8");

const fixLog = [];

// 各問題の修正データ
const fixes = {
  Q_L_001: {
    question: `【現金勘定記入問題】

2025年4月の現金勘定を作成してください。

【取引データ】
4月 1日: 前月繰越高 300,000円
4月 5日: 商品を現金で売り上げた 85,000円
4月10日: 給料を現金で支払った 120,000円
4月15日: 備品を現金で購入した 45,000円
4月20日: 売掛金を現金で回収した 60,000円
4月25日: 水道光熱費を現金で支払った 12,000円

【記入要求】
・T字勘定形式での記入
・借方・貸方の適切な区分
・残高の継続的な計算`,
    tags: '{"subcategory":"account_entry","pattern":"勘定記入問題","accounts":["現金"],"keywords":["現金勘定","T字勘定","借方貸方"],"examSection":2}',
  },
  Q_L_002: {
    question: `【当座預金勘定記入問題】

2025年5月の当座預金勘定を作成してください。

【取引データ】
5月 1日: 前月繰越高 500,000円
5月 8日: 売掛金を当座預金口座に入金 150,000円
5月12日: 買掛金を小切手で支払った 85,000円
5月18日: 給料を銀行振込で支払った 200,000円
5月22日: 商品売上代金を当座預金に入金 120,000円
5月28日: 家賃を口座振替で支払った 80,000円

【記入要求】
・T字勘定形式での記入
・借方・貸方の適切な区分
・残高の継続的な計算`,
    tags: '{"subcategory":"account_entry","pattern":"勘定記入問題","accounts":["当座預金"],"keywords":["当座預金勘定","T字勘定","小切手"],"examSection":2}',
  },
  Q_L_003: {
    question: `【売掛金勘定記入問題】

2025年6月の売掛金勘定（総勘定）を作成してください。

【取引データ】
6月 1日: 前月繰越高 420,000円
6月 7日: A商店へ商品を掛けで売り上げた 180,000円
6月14日: B商店より売掛金を現金で回収 150,000円
6月20日: C商店へ商品を掛けで売り上げた 200,000円
6月25日: A商店より約束手形を受け取った 100,000円

【記入要求】
・T字勘定形式での記入
・借方・貸方の適切な区分
・得意先別の管理`,
    tags: '{"subcategory":"account_entry","pattern":"勘定記入問題","accounts":["売掛金"],"keywords":["売掛金勘定","T字勘定","掛売上"],"examSection":2}',
  },
  Q_L_004: {
    question: `【商品勘定記入問題（三分法）】

2025年7月の商品勘定を三分法で作成してください。

【取引データ】
7月 1日: 前月繰越高 350,000円
7月 6日: 商品を掛けで仕入れた 220,000円
7月12日: 商品を掛けで売り上げた（原価180,000円）
7月18日: 商品を現金で仕入れた 150,000円
7月24日: 商品を現金で売り上げた（原価120,000円）
7月31日: 月末商品棚卸高 420,000円

【記入要求】
・三分法による記入
・仕入・売上原価の適切な処理
・期末商品の振替処理`,
    tags: '{"subcategory":"account_entry","pattern":"勘定記入問題","accounts":["商品","仕入","売上原価"],"keywords":["商品勘定","三分法","棚卸"],"examSection":2}',
  },
  Q_L_005: {
    question: `【買掛金勘定記入問題】

2025年8月の買掛金勘定（総勘定）を作成してください。

【取引データ】
8月 1日: 前月繰越高 380,000円
8月 5日: D商店より商品を掛けで仕入れた 150,000円
8月11日: E商店へ買掛金を現金で支払った 120,000円
8月17日: F商店より商品を掛けで仕入れた 180,000円
8月23日: D商店へ約束手形を振り出した 100,000円
8月29日: E商店へ小切手で支払った 80,000円

【記入要求】
・T字勘定形式での記入
・借方・貸方の適切な区分
・仕入先別の管理`,
    tags: '{"subcategory":"account_entry","pattern":"勘定記入問題","accounts":["買掛金"],"keywords":["買掛金勘定","T字勘定","掛仕入"],"examSection":2}',
  },
  Q_L_006: {
    question: `【支払手形勘定記入問題】

2025年9月の支払手形勘定を作成してください。

【取引データ】
9月 1日: 前月繰越高 250,000円
9月 8日: G商店に対して約束手形を振り出した 120,000円
9月15日: 前月振り出した手形が満期決済された 80,000円
9月22日: H商店に対して約束手形を振り出した 150,000円
9月28日: 前々月の手形が満期決済された 70,000円

【記入要求】
・T字勘定形式での記入
・振出と決済の適切な処理
・満期管理の明示`,
    tags: '{"subcategory":"account_entry","pattern":"勘定記入問題","accounts":["支払手形"],"keywords":["支払手形勘定","約束手形","満期決済"],"examSection":2}',
  },
  Q_L_007: {
    question: `【資本金勘定記入問題】

2025年10月の資本金勘定を作成してください。

【取引データ】
10月 1日: 期首資本金 5,000,000円
10月10日: 増資により現金1,000,000円の払込を受けた
10月20日: 増資により土地2,000,000円の現物出資を受けた
10月31日: 当期純利益500,000円を資本に組み入れた

【記入要求】
・T字勘定形式での記入
・増資の適切な処理
・資本の変動要因の明示`,
    tags: '{"subcategory":"account_entry","pattern":"勘定記入問題","accounts":["資本金"],"keywords":["資本金勘定","増資","現物出資"],"examSection":2}',
  },
  Q_L_008: {
    question: `【売上勘定記入問題】

2025年11月の売上勘定を作成してください。

【取引データ】
11月 3日: 商品を現金で売り上げた 180,000円
11月 9日: 商品を掛けで売り上げた 250,000円
11月15日: 商品を小切手で売り上げた 120,000円
11月21日: 売上値引 15,000円
11月27日: 商品を掛けで売り上げた 200,000円
11月30日: 売上返品 25,000円

【記入要求】
・T字勘定形式での記入
・売上値引・返品の適切な処理
・月次売上高の計算`,
    tags: '{"subcategory":"account_entry","pattern":"勘定記入問題","accounts":["売上"],"keywords":["売上勘定","売上値引","売上返品"],"examSection":2}',
  },
  Q_L_009: {
    question: `【給料勘定記入問題】

2025年12月の給料勘定を作成してください。

【取引データ】
12月 5日: 従業員給料を現金で支払った 450,000円
12月10日: アルバイト給料を銀行振込で支払った 120,000円
12月15日: 役員報酬を銀行振込で支払った 300,000円
12月25日: 賞与を現金で支払った 200,000円
12月31日: 未払給料を計上した 80,000円

【記入要求】
・T字勘定形式での記入
・費用の発生と支払の区別
・未払給料の適切な処理`,
    tags: '{"subcategory":"account_entry","pattern":"勘定記入問題","accounts":["給料"],"keywords":["給料勘定","人件費","未払給料"],"examSection":2}',
  },
};

// 修正実行
for (const [id, fixData] of Object.entries(fixes)) {
  console.log(`\n🔍 ${id} 修正中...`);

  // 問題文の修正
  const questionPattern = new RegExp(
    `(id:\\s*"${id}"[\\s\\S]*?question_text:\\s*)"[^"]*"`,
    "s",
  );

  if (content.match(questionPattern)) {
    content = content.replace(
      questionPattern,
      `$1"${fixData.question.replace(/\n/g, "\\n")}"`,
    );
    fixLog.push(`✅ ${id}: 問題文に具体的取引データを追加`);
  }

  // タグの修正
  const tagsPattern = new RegExp(
    `(id:\\s*"${id}"[\\s\\S]*?tags_json:\\s*')([^']*)'`,
    "s",
  );

  if (content.match(tagsPattern)) {
    content = content.replace(tagsPattern, `$1${fixData.tags}'`);
    fixLog.push(`✅ ${id}: タグを適切に修正`);
  }
}

// ファイル保存
console.log("\n💾 修正内容を保存中...");
fs.writeFileSync(questionsPath, content);

// 修正結果のサマリー
console.log("\n📊 パターン1修正結果サマリー");
console.log("=" + "=".repeat(40));
fixLog.forEach((log) => console.log(log));

console.log("\n✅ パターン1の修正完了");
console.log("📝 次のステップ: TypeScript構文チェック実行");
